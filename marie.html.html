<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® Deutscher Rechtschreibtrainer ‚ú®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            background: linear-gradient(135deg, #FFE5EC 0%, #FFC8DD 50%, #FFB3D9 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(255, 182, 193, 0.4);
        }

        .welcome-screen {
            text-align: center;
        }

        .welcome-screen h1 {
            color: #FF69B4;
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(255, 105, 180, 0.3);
        }

        .welcome-screen input {
            padding: 15px 25px;
            font-size: 1.2em;
            border: 3px solid #FFB6C1;
            border-radius: 20px;
            margin: 20px 0;
            width: 80%;
            max-width: 400px;
            text-align: center;
            background: #FFF0F5;
        }

        .welcome-screen button {
            padding: 15px 40px;
            font-size: 1.3em;
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.4);
            transition: transform 0.2s;
        }

        .welcome-screen button:hover {
            transform: scale(1.05);
        }

        .game-screen {
            display: none;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .student-name {
            font-size: 1.5em;
            color: #FF69B4;
            font-weight: bold;
        }

        .stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: linear-gradient(135deg, #FFE5EC, #FFC8DD);
            padding: 10px 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(255, 182, 193, 0.3);
        }

        .stat-label {
            font-size: 0.8em;
            color: #C71585;
            font-weight: bold;
        }

        .stat-value {
            font-size: 1.5em;
            color: #FF1493;
            font-weight: bold;
        }

        .progress-section {
            background: #FFF0F5;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 30px;
        }

        .progress-bar {
            width: 100%;
            height: 40px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF69B4, #FFB6C1, #FFC0CB);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            min-width: 50px;
        }

        .level-display {
            text-align: center;
            margin-top: 15px;
            font-size: 1.3em;
            color: #C71585;
            font-weight: bold;
        }

        .word-display {
            background: #FFE5EC;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            margin-bottom: 30px;
        }

        .misspelled-word {
            font-size: 3em;
            color: #FF1493;
            font-weight: bold;
            letter-spacing: 5px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .misspelled-word:hover {
            transform: scale(1.05);
        }

        .speaker-icon {
            font-size: 0.6em;
            margin-left: 10px;
            opacity: 0.7;
        }

        .instruction {
            color: #C71585;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .letter-boxes {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .letter-box {
            width: 60px;
            height: 70px;
            background: white;
            border: 3px solid #FFB6C1;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: #FF1493;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .letter-box:hover {
            background: #FFF0F5;
            transform: translateY(-3px);
        }

        .letter-box.empty {
            background: #FFF0F5;
            border-style: dashed;
        }

        .letter-bank {
            background: #FFC8DD;
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 30px;
        }

        .letter-bank-title {
            text-align: center;
            color: white;
            font-size: 1.2em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .letter-bank-letters {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .bank-letter {
            width: 50px;
            height: 50px;
            background: white;
            border: 2px solid #FF69B4;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #FF1493;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .bank-letter:hover:not(.used) {
            background: #FFE5EC;
            transform: scale(1.1);
        }

        .bank-letter.used {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-check {
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
            color: white;
        }

        .btn-skip {
            background: linear-gradient(135deg, #DDA0DD, #EE82EE);
            color: white;
        }

        .mode-toggle {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #FFB6C1;
            background: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            color: #C71585;
            font-weight: bold;
        }

        .mode-btn:hover {
            transform: scale(1.05);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
            color: white;
            border-color: #FF69B4;
        }

        .feedback {
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
            min-height: 40px;
        }

        .feedback.correct {
            color: #32CD32;
            animation: bounce 0.5s;
        }

        .feedback.incorrect {
            color: #FF4500;
            animation: shake 0.5s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .backup-section {
            background: #FFF0F5;
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
        }

        .backup-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn-backup {
            padding: 10px 20px;
            background: linear-gradient(135deg, #9370DB, #BA55D3);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-backup:hover {
            transform: scale(1.05);
        }

        .star {
            position: fixed;
            font-size: 2em;
            animation: float-up 2s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes float-up {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-200px) scale(1.5); opacity: 0; }
        }

        .sprinkle {
            position: fixed;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: sprinkle-fall 1s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes sprinkle-fall {
            0% { transform: translateY(-50px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(200px) rotate(360deg); opacity: 0; }
        }

        .encouragement {
            background: linear-gradient(135deg, #FFE5EC, #FFC8DD);
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 1.2em;
            color: #C71585;
            font-weight: bold;
        }

        input[type="file"] {
            display: none;
        }

        .file-label {
            padding: 10px 20px;
            background: linear-gradient(135deg, #9370DB, #BA55D3);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            display: inline-block;
        }

        .file-label:hover {
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .misspelled-word {
                font-size: 2em;
                letter-spacing: 2px;
            }
            
            .letter-box {
                width: 50px;
                height: 60px;
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="welcome-screen" id="welcomeScreen">
            <h1>‚ú® Willkommen beim Rechtschreibtrainer! ‚ú®</h1>
            <p style="font-size: 1.3em; color: #FF69B4; margin: 20px 0;">
                Lerne die h√§ufigsten deutschen W√∂rter richtig zu schreiben!
            </p>
            <div style="font-size: 3em; margin: 30px 0;">üåü üìö ‚ú®</div>
            <input type="text" id="studentName" placeholder="Gib deinen Namen ein..." maxlength="30">
            <br>
            <button onclick="startTraining()">Los geht's! üöÄ</button>
        </div>

        <div class="game-screen" id="gameScreen">
            <div class="header">
                <div class="student-name" id="displayName">‚≠ê </div>
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-label">Level</div>
                        <div class="stat-value" id="levelDisplay">1</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Punkte</div>
                        <div class="stat-value" id="pointsDisplay">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Serie</div>
                        <div class="stat-value" id="streakDisplay">0</div>
                    </div>
                </div>
            </div>

            <div class="progress-section">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%;">
                        <span id="progressText">0%</span>
                    </div>
                </div>
                <div class="level-display" id="masteryDisplay">
                    Du beherrschst <span id="masteredWords">0</span> von <span id="totalWords">0</span> W√∂rtern! üéØ
                </div>
            </div>

            <div class="mode-toggle">
                <button class="mode-btn active" id="sequentialBtn" onclick="setMode('sequential')">
                    üìñ Der Reihe nach
                </button>
                <button class="mode-btn" id="difficultyBtn" onclick="setMode('difficulty')">
                    ‚ö° Schwierigkeit erh√∂hen
                </button>
            </div>

            <div class="word-display">
                <div class="misspelled-word" id="misspelledWord" onclick="speakWord()">
                    <span id="wordText"></span>
                    <span class="speaker-icon">üîä</span>
                </div>
                <div class="instruction">Klicke auf einen Buchstaben zum Entfernen, oder w√§hle aus der Bank unten!</div>
            </div>

            <div class="letter-boxes" id="letterBoxes"></div>

            <div class="letter-bank">
                <div class="letter-bank-title">Buchstaben-Bank</div>
                <div class="letter-bank-letters" id="letterBank"></div>
            </div>

            <div class="feedback" id="feedback"></div>

            <div class="action-buttons">
                <button class="btn btn-check" onclick="checkAnswer()">‚úÖ Pr√ºfen</button>
                <button class="btn btn-skip" onclick="skipWord()">‚è≠Ô∏è √úberspringen</button>
            </div>

            <div class="encouragement" id="encouragement">
                Du schaffst das! Jedes Wort bringt dich weiter! üåü
            </div>

            <div class="backup-section">
                <strong>Daten sichern:</strong>
                <div class="backup-buttons">
                    <button class="btn-backup" onclick="downloadBackup()">üíæ Backup herunterladen</button>
                    <label for="fileInput" class="file-label">üìÇ Backup hochladen</label>
                    <input type="file" id="fileInput" accept=".json" onchange="uploadBackup(event)">
                </div>
            </div>
        </div>
    </div>

    <script>
        /* 
         * HINWEIS: Ersetze diese Wortliste mit deiner vollst√§ndigen Liste von 10.000 W√∂rtern!
         * Dies ist nur eine Beispielliste zum Testen.
         */
        const WORD_LIST_STRING = `der
die
und
in
den
von
zu
das
mit
sich
des
auf
f√ºr
ist
im
dem
nicht
ein
Die
eine
als
auch
es
an
werden
aus
er
hat
da√ü
sie
nach
wird
bei
einer
Der
um
am
sind
noch
wie
einem
√ºber
einen
Das
so
Sie
zum
war
haben
nur
oder
aber
vor
zur
bis
mehr
durch
man
sein
wurde
sei
In
Prozent
hatte
kann
gegen
vom
k√∂nnen
schon
wenn
habe
seine
Mark
ihre
dann
unter
wir
soll
ich
eines
Es
Jahr
zwei
Jahren
diese
dieser
wieder
keine
Uhr
seiner
worden
Und
will
zwischen
Im
immer
Millionen
Ein
was
sagte
Er
gibt
alle
DM
diesem
seit
mu√ü
wurden
beim
doch
jetzt
waren
drei
Jahre
Mit
neue
neuen
damit
bereits
da
Auch
ihr
seinen
m√ºssen
ab
ihrer
Nach
ohne
sondern
selbst
ersten
nun
etwa
Bei
heute
ihren
weil
ihm
seien
Menschen
Deutschland
anderen
werde
Ich
sagt
Wir
Eine
rund
F√ºr
Aber
ihn
Ende
jedoch
Zeit
sollen
ins
Wenn
So
seinem
uns
Stadt
geht
Doch
sehr
hier
ganz
erst
wollen
Berlin`;

        // Convert string to array and take only first 100 for demo (replace with your full list)
        const WORDS = WORD_LIST_STRING.split('\n').map(w => w.trim()).filter(w => w);

        // Game state
        let gameState = {
            studentName: '',
            currentWordIndex: 0,
            points: 0,
            streak: 0,
            level: 1,
            mode: 'sequential',
            words: [],
            currentWord: null,
            misspelledWord: '',
            userAnswer: [],
            letterBank: [],
            usedLetters: []
        };

        // Spaced repetition boxes
        let spacedRepetition = {};

        // Initialize spaced repetition for all words
        function initializeSpacedRepetition() {
            WORDS.forEach((word, index) => {
                spacedRepetition[index] = {
                    box: 0,
                    correctCount: 0,
                    lastReviewed: null,
                    mastered: false
                };
            });
        }

        // Misspell a word by adding/removing/changing letters
        function misspellWord(word) {
            const letters = word.split('');
            const changes = Math.floor(Math.random() * 2) + 2; // 2-3 changes
            
            for (let i = 0; i < changes && letters.length > 2; i++) {
                const action = Math.floor(Math.random() * 3);
                const pos = Math.floor(Math.random() * letters.length);
                
                if (action === 0 && letters.length > 3) {
                    // Remove a letter
                    letters.splice(pos, 1);
                } else if (action === 1) {
                    // Change a letter
                    const randomLetter = String.fromCharCode(97 + Math.floor(Math.random() * 26));
                    letters[pos] = randomLetter;
                } else {
                    // Add a random letter
                    const randomLetter = String.fromCharCode(97 + Math.floor(Math.random() * 26));
                    letters.splice(pos, 0, randomLetter);
                }
            }
            
            return letters.join('');
        }

        // Generate letter bank
        function generateLetterBank(correctWord, misspelled) {
            const needed = correctWord.split('').filter(l => !misspelled.split('').includes(l));
            const extra = [];
            const numExtra = Math.min(8, Math.floor(correctWord.length * 0.5));
            
            for (let i = 0; i < numExtra; i++) {
                extra.push(String.fromCharCode(97 + Math.floor(Math.random() * 26)));
            }
            
            const bank = [...misspelled.split(''), ...needed, ...extra];
            return bank.sort(() => Math.random() - 0.5);
        }

        // Get next word based on mode
        function getNextWord() {
            if (gameState.mode === 'sequential') {
                return gameState.currentWordIndex;
            } else {
                // Difficulty mode - get from lowest box
                let lowestBox = 0;
                const availableIndices = [];
                
                for (let i = 0; i < WORDS.length; i++) {
                    if (spacedRepetition[i].box === lowestBox && !spacedRepetition[i].mastered) {
                        availableIndices.push(i);
                    }
                }
                
                if (availableIndices.length === 0) {
                    lowestBox++;
                    for (let i = 0; i < WORDS.length; i++) {
                        if (spacedRepetition[i].box === lowestBox && !spacedRepetition[i].mastered) {
                            availableIndices.push(i);
                        }
                    }
                }
                
                return availableIndices[Math.floor(Math.random() * availableIndices.length)] || 0;
            }
        }

        // Load new word
        function loadWord() {
            const wordIndex = getNextWord();
            gameState.currentWordIndex = wordIndex;
            gameState.currentWord = WORDS[wordIndex];
            gameState.misspelledWord = misspellWord(gameState.currentWord);
            gameState.userAnswer = gameState.misspelledWord.split('');
            gameState.letterBank = generateLetterBank(gameState.currentWord, gameState.misspelledWord);
            gameState.usedLetters = [];
            
            renderWord();
            updateEncouragement();
        }

        // Render word and letter bank
        function renderWord() {
            document.getElementById('wordText').textContent = gameState.misspelledWord;
            
            const letterBoxes = document.getElementById('letterBoxes');
            letterBoxes.innerHTML = '';
            gameState.userAnswer.forEach((letter, index) => {
                const box = document.createElement('div');
                box.className = 'letter-box';
                box.textContent = letter || '';
                if (!letter) box.classList.add('empty');
                box.onclick = () => removeLetter(index);
                letterBoxes.appendChild(box);
            });
            
            const letterBank = document.getElementById('letterBank');
            letterBank.innerHTML = '';
            gameState.letterBank.forEach((letter, index) => {
                const bankLetter = document.createElement('div');
                bankLetter.className = 'bank-letter';
                bankLetter.textContent = letter;
                if (gameState.usedLetters.includes(index)) {
                    bankLetter.classList.add('used');
                } else {
                    bankLetter.onclick = () => addLetter(letter, index);
                }
                letterBank.appendChild(bankLetter);
            });
        }

        // Add letter from bank
        function addLetter(letter, bankIndex) {
            const emptyIndex = gameState.userAnswer.indexOf('');
            if (emptyIndex !== -1) {
                gameState.userAnswer[emptyIndex] = letter;
                gameState.usedLetters.push(bankIndex);
                renderWord();
            }
        }

        // Remove letter
        function removeLetter(index) {
            if (gameState.userAnswer[index]) {
                const letter = gameState.userAnswer[index];
                const bankIndex = gameState.letterBank.indexOf(letter);
                if (bankIndex !== -1 && gameState.usedLetters.includes(bankIndex)) {
                    gameState.usedLetters = gameState.usedLetters.filter(i => i !== bankIndex);
                }
                gameState.userAnswer[index] = '';
                renderWord();
            }
        }

        // Check answer
        function checkAnswer() {
            const userWord = gameState.userAnswer.join('');
            const feedback = document.getElementById('feedback');
            
            if (userWord === gameState.currentWord) {
                feedback.textContent = 'üéâ Richtig! Super gemacht! üéâ';
                feedback.className = 'feedback correct';
                
                gameState.points += 10 * gameState.level;
                gameState.streak++;
                
                // Update spaced repetition
                const wordIndex = gameState.currentWordIndex;
                spacedRepetition[wordIndex].correctCount++;
                spacedRepetition[wordIndex].box = Math.min(5, spacedRepetition[wordIndex].box + 1);
                spacedRepetition[wordIndex].lastReviewed = new Date();
                
                if (spacedRepetition[wordIndex].box >= 5) {
                    spacedRepetition[wordIndex].mastered = true;
                }
                
                // Check level up
                if (gameState.streak % 5 === 0) {
                    gameState.level++;
                    showLevelUp();
                }
                
                createStars();
                updateStats();
                saveProgress();
                
                setTimeout(() => {
                    gameState.currentWordIndex++;
                    if (gameState.currentWordIndex >= WORDS.length) {
                        gameState.currentWordIndex = 0;
                    }
                    loadWord();
                    feedback.textContent = '';
                    feedback.className = 'feedback';
                }, 2000);
            } else {
                feedback.textContent = '‚ùå Nicht ganz richtig. Versuch es noch einmal!';
                feedback.className = 'feedback incorrect';
                
                gameState.streak = 0;
                
                // Move back to box 0
                const wordIndex = gameState.currentWordIndex;
                spacedRepetition[wordIndex].box = 0;
                spacedRepetition[wordIndex].correctCount = 0;
                spacedRepetition[wordIndex].mastered = false;
                
                updateStats();
                saveProgress();
                
                setTimeout(() => {
                    feedback.textContent = '';
                    feedback.className = 'feedback';
                }, 2000);
            }
        }

        // Skip word
        function skipWord() {
            gameState.currentWordIndex++;
            if (gameState.currentWordIndex >= WORDS.length) {
                gameState.currentWordIndex = 0;
            }
            loadWord();
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
        }

        // Text-to-speech
        function speakWord() {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(gameState.currentWord);
                utterance.lang = 'de-DE';
                speechSynthesis.speak(utterance);
            }
        }

        // Set mode
        function setMode(mode) {
            gameState.mode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode === 'sequential' ? 'sequentialBtn' : 'difficultyBtn').classList.add('active');
            loadWord();
        }

        // Update stats
        function updateStats() {
            document.getElementById('levelDisplay').textContent = gameState.level;
            document.getElementById('pointsDisplay').textContent = gameState.points;
            document.getElementById('streakDisplay').textContent = gameState.streak;
            
            const mastered = Object.values(spacedRepetition).filter(w => w.mastered).length;
            document.getElementById('masteredWords').textContent = mastered;
            document.getElementById('totalWords').textContent = WORDS.length;
            
            const percentage = Math.round((mastered / WORDS.length) * 100);
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = percentage + '%';
        }

        // Create star animation
        function createStars() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.textContent = ['‚≠ê', '‚ú®', 'üåü', 'üí´'][Math.floor(Math.random() * 4)];
                    star.style.left = Math.random() * window.innerWidth + 'px';
                    star.style.top = Math.random() * window.innerHeight + 'px';
                    document.body.appendChild(star);
                    
                    setTimeout(() => star.remove(), 2000);
                }, i * 200);
            }
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const sprinkle = document.createElement('div');
                    sprinkle.className = 'sprinkle';
                    sprinkle.style.left = Math.random() * window.innerWidth + 'px';
                    sprinkle.style.top = '0px';
                    sprinkle.style.background = ['#FF69B4', '#FFB6C1', '#FFC0CB', '#FFE5EC'][Math.floor(Math.random() * 4)];
                    document.body.appendChild(sprinkle);
                    
                    setTimeout(() => sprinkle.remove(), 1000);
                }, i * 100);
            }
        }

        // Show level up
        function showLevelUp() {
            const encouragement = document.getElementById('encouragement');
            encouragement.textContent = `üéä Level ${gameState.level}! Du bist gro√üartig! üéä`;
            encouragement.style.fontSize = '1.5em';
            
            createStars();
            
            setTimeout(() => {
                encouragement.style.fontSize = '1.2em';
                updateEncouragement();
            }, 3000);
        }

        // Update encouragement
        function updateEncouragement() {
            const messages = [
                'Du machst das super! Weiter so! üåü',
                'Fantastisch! Jedes Wort bringt dich weiter! ‚ú®',
                'Du bist auf dem richtigen Weg! üí™',
                'Toll gemacht! Du lernst so schnell! üöÄ',
                'Wow! Du bist ein Rechtschreib-Champion! üèÜ',
                'Gro√üartig! Deine Fortschritte sind beeindruckend! ‚≠ê',
                'Weiter so! Du beherrschst immer mehr W√∂rter! üìö',
                'Hervorragend! Du bist ein echter Profi! üéØ'
            ];
            
            document.getElementById('encouragement').textContent = messages[Math.floor(Math.random() * messages.length)];
        }

        // Save progress
        function saveProgress() {
            const data = {
                studentName: gameState.studentName,
                points: gameState.points,
                level: gameState.level,
                streak: gameState.streak,
                currentWordIndex: gameState.currentWordIndex,
                mode: gameState.mode,
                spacedRepetition: spacedRepetition,
                lastSaved: new Date().toISOString()
            };
            localStorage.setItem('rechtschreibtrainer', JSON.stringify(data));
        }

        // Load progress
        function loadProgress() {
            const saved = localStorage.getItem('rechtschreibtrainer');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    gameState.points = data.points || 0;
                    gameState.level = data.level || 1;
                    gameState.streak = data.streak || 0;
                    gameState.currentWordIndex = data.currentWordIndex || 0;
                    gameState.mode = data.mode || 'sequential';
                    spacedRepetition = data.spacedRepetition || {};
                    return true;
                } catch (e) {
                    console.error('Error loading progress:', e);
                }
            }
            return false;
        }

        // Download backup
        function downloadBackup() {
            const data = {
                studentName: gameState.studentName,
                points: gameState.points,
                level: gameState.level,
                streak: gameState.streak,
                currentWordIndex: gameState.currentWordIndex,
                mode: gameState.mode,
                spacedRepetition: spacedRepetition,
                backupDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rechtschreibtrainer_backup_${gameState.studentName}_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Upload backup
        function uploadBackup(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        gameState.points = data.points || 0;
                        gameState.level = data.level || 1;
                        gameState.streak = data.streak || 0;
                        gameState.currentWordIndex = data.currentWordIndex || 0;
                        gameState.mode = data.mode || 'sequential';
                        spacedRepetition = data.spacedRepetition || {};
                        
                        saveProgress();
                        updateStats();
                        loadWord();
                        
                        alert('Backup erfolgreich geladen!');
                    } catch (error) {
                        alert('Fehler beim Laden des Backups. Bitte versuche es erneut.');
                        console.error('Error loading backup:', error);
                    }
                };
                reader.readAsText(file);
            }
        }

        // Start training
        function startTraining() {
            const name = document.getElementById('studentName').value.trim();
            if (!name) {
                alert('Bitte gib deinen Namen ein!');
                return;
            }
            
            gameState.studentName = name;
            document.getElementById('displayName').textContent = '‚≠ê ' + name;
            
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            initializeSpacedRepetition();
            
            const hasProgress = loadProgress();
            if (hasProgress && gameState.studentName === name) {
                updateStats();
            }
            
            loadWord();
            updateStats();
        }

        // Initialize on page load
        window.onload = function() {
            initializeSpacedRepetition();
            document.getElementById('totalWords').textContent = WORDS.length;
        };
    </script>
</body>
</html>