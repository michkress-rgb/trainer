<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>German Vocabulary Quest - 5. Klasse List 8</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .title {
            font-size: 2.5em;
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            min-width: 150px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .game-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .game-mode-btn {
            background: white;
            border: none;
            padding: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
        }

        .game-mode-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        .game-mode-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .game-area {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 500px;
            display: none;
        }

        .game-area.active {
            display: block;
        }

        .direction-toggle {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .toggle-btn {
            padding: 12px 30px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .toggle-btn.active {
            background: #667eea;
            color: white;
        }

        .match-game {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        .column {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .column-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
        }

        .word-item {
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: move;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }

        .word-item:hover {
            background: #e9ecef;
            transform: scale(1.02);
        }

        .word-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .drop-zone {
            padding: 15px 20px;
            background: white;
            border: 2px dashed #667eea;
            border-radius: 10px;
            min-height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.1em;
            color: #999;
        }

        .drop-zone.drag-over {
            background: #e7e9ff;
            border-color: #764ba2;
            transform: scale(1.05);
        }

        .drop-zone.filled {
            background: #d4edda;
            border-color: #28a745;
            color: #333;
        }

        .drop-zone.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .spelling-game {
            max-width: 600px;
            margin: 0 auto;
        }

        .word-display {
            font-size: 2em;
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            margin-bottom: 30px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .letter-bank {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
            min-height: 80px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .letter-tile {
            width: 50px;
            height: 50px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            cursor: move;
            transition: all 0.3s ease;
            color: #667eea;
        }

        .letter-tile:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .letter-tile.used {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .answer-area {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            min-height: 80px;
            padding: 20px;
            background: white;
            border: 3px dashed #667eea;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .answer-slot {
            width: 50px;
            height: 50px;
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .answer-slot.filled {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f0f0f0;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .feedback {
            text-align: center;
            padding: 20px;
            margin-top: 20px;
            border-radius: 10px;
            font-size: 1.3em;
            font-weight: bold;
            display: none;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            display: block;
            animation: slideIn 0.5s;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            display: block;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .badge-display {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .badge {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .badge:hover {
            transform: scale(1.1);
        }

        .badge.locked {
            background: #ddd;
            opacity: 0.5;
            filter: grayscale(100%);
        }

        .badge.unlocked {
            animation: bounce 0.5s;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .badge-tooltip {
            position: absolute;
            bottom: -30px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.4em;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .badge:hover .badge-tooltip {
            opacity: 1;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.3);
            text-align: center;
            display: none;
            z-index: 1000;
            animation: popIn 0.5s;
        }

        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .celebration.show {
            display: block;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 999;
        }

        .overlay.show {
            display: block;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            position: absolute;
            animation: confetti-fall 3s linear forwards;
            z-index: 1000;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: gold;
            border-radius: 50%;
            animation: sparkle-fade 1s ease-out forwards;
            pointer-events: none;
        }

        @keyframes sparkle-fade {
            0% {
                transform: translate(0, 0) scale(0);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(1);
                opacity: 0;
            }
        }

        .star-burst {
            position: fixed;
            font-size: 2em;
            animation: star-burst 1s ease-out forwards;
            pointer-events: none;
            z-index: 999;
        }

        @keyframes star-burst {
            0% {
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(3) rotate(180deg);
                opacity: 0;
            }
        }

        .flashcard {
            width: 100%;
            height: 400px;
            perspective: 1000px;
            cursor: pointer;
            margin: 20px 0;
        }

        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flashcard-inner.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-front,
        .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            font-size: 2em;
            font-weight: bold;
            padding: 40px;
            text-align: center;
        }

        .flashcard-front {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .flashcard-back {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            transform: rotateY(180deg);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üéÆ German Vocabulary Quest</h1>
            
            <div style="text-align: center; margin: 15px 0;">
                <select id="listSelector" onchange="changeVocabList()" style="padding: 10px 20px; font-size: 1.1em; border-radius: 10px; border: 2px solid #667eea; background: white; color: #667eea; cursor: pointer; font-weight: bold;">
                    <option value="list8">üìö List 8 - Home & Living</option>
                    <option value="list9">üìö List 9 - Room & Furniture</option>
                </select>
            </div>
            
            <div class="stats-bar">
                <div class="stat-box">
                    <div class="stat-label">Level</div>
                    <div class="stat-value" id="level">1</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">XP</div>
                    <div class="stat-value"><span id="xp">0</span>/<span id="xpNeeded">100</span></div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Score</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Streak</div>
                    <div class="stat-value">üî• <span id="streak">0</span></div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%">0%</div>
            </div>
            <div class="badge-display" id="badgeDisplay"></div>
        </div>

        <div class="game-selection">
            <button class="game-mode-btn" onclick="selectGameMode('match', this)">
                üéØ Match Game<br><small>Drag & drop translations</small>
            </button>
            <button class="game-mode-btn" onclick="selectGameMode('spell', this)">
                ‚úèÔ∏è Spelling Quest<br><small>Build the words</small>
            </button>
            <button class="game-mode-btn" onclick="selectGameMode('flashcard', this)">
                üÉè Flashcard Flip<br><small>Test your memory</small>
            </button>
        </div>

        <div class="game-area" id="matchGame">
            <div class="direction-toggle">
                <button class="toggle-btn active" onclick="setDirection('de-en', this)">üá©üá™ German ‚Üí English</button>
                <button class="toggle-btn" onclick="setDirection('en-de', this)">üá¨üáß English ‚Üí German</button>
            </div>
            <div class="match-game" id="matchGameArea"></div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="checkMatches()">Check Answers</button>
                <button class="btn btn-secondary" onclick="resetMatchGame()">Reset</button>
                <button class="btn btn-secondary" onclick="newMatchRound()">New Round</button>
            </div>
            <div class="feedback" id="matchFeedback"></div>
        </div>

        <div class="game-area" id="spellGame">
            <div class="direction-toggle">
                <button class="toggle-btn active" onclick="setSpellDirection('de-en', this)">üá©üá™ German ‚Üí English</button>
                <button class="toggle-btn" onclick="setSpellDirection('en-de', this)">üá¨üáß English ‚Üí German</button>
            </div>
            <div class="spelling-game">
                <div class="word-display" id="wordPrompt"></div>
                <div class="letter-bank" id="letterBank"></div>
                <div class="answer-area" id="answerArea"></div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="checkSpelling()">Check Answer</button>
                    <button class="btn btn-secondary" onclick="clearSpelling()">Clear</button>
                    <button class="btn btn-secondary" onclick="nextSpellingWord()">Next Word</button>
                </div>
                <div class="feedback" id="spellFeedback"></div>
            </div>
        </div>

        <div class="game-area" id="flashcardGame">
            <div class="direction-toggle">
                <button class="toggle-btn active" onclick="setFlashDirection('de-en', this)">üá©üá™ German ‚Üí English</button>
                <button class="toggle-btn" onclick="setFlashDirection('en-de', this)">üá¨üáß English ‚Üí German</button>
            </div>
            <div style="max-width: 700px; margin: 0 auto; text-align: center;">
                <div style="margin-bottom: 20px;">
                    <span style="font-size: 1.2em; color: #667eea; font-weight: bold;">Card <span id="cardNumber">1</span> of <span id="totalCards">0</span></span>
                </div>
                <div style="margin-bottom: 15px; padding: 10px; background: #fff3cd; border-radius: 10px; border: 2px solid #ffc107;">
                    <span style="color: #856404; font-weight: bold;">üëÜ Click the card below to flip it and see the answer!</span>
                </div>
                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <div class="flashcard-inner" id="flashcardInner">
                        <div class="flashcard-front">
                            <div id="flashFront"></div>
                        </div>
                        <div class="flashcard-back">
                            <div id="flashBack"></div>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 30px;">
                    <p style="color: #666; margin-bottom: 20px; font-weight: bold;">Rate your knowledge:</p>
                    <div class="button-group">
                        <button class="btn" style="background: #dc3545; color: white;" onclick="rateCard('wrong')">‚ùå Don't Know</button>
                        <button class="btn" style="background: #ffc107; color: white;" onclick="rateCard('hard')">üòì Hard</button>
                        <button class="btn" style="background: #28a745; color: white;" onclick="rateCard('good')">‚úÖ Got It!</button>
                    </div>
                </div>
                <div class="feedback" id="flashFeedback"></div>
            </div>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="celebration" id="celebration">
        <h2 style="color: #667eea; margin-bottom: 20px;">üéâ Congratulations! üéâ</h2>
        <p id="celebrationText" style="font-size: 1.3em; margin-bottom: 20px;"></p>
        <button class="btn btn-primary" onclick="closeCelebration()">Continue</button>
    </div>

    <script>
        const vocabularyLists = {
            list8: [
                {de: "etwas tun wollen", en: "want to do something"},
                {de: "etwas (haben) wollen", en: "want something"},
                {de: "wollen", en: "want"},
                {de: "der Baum", en: "tree"},
                {de: "die Tour, die Reise, der Rundgang / die Rundfahrt", en: "tour / trip / round trip"},
                {de: "die oberste Etage", en: "top floor"},
                {de: "die Spitze, das obere Ende", en: "top"},
                {de: "erz√§hlen, sagen", en: "tell"},
                {de: "besondere", en: "special"},
                {de: "der Schuh", en: "shoe"},
                {de: "ziemlich, ganz", en: "quite"},
                {de: "passiv", en: "passive"},
                {de: "die Eidechse", en: "lizard"},
                {de: "das Wohnzimmer", en: "living room"},
                {de: "leben, wohnen", en: "live"},
                {de: "die Lampe", en: "lamp"},
                {de: "die K√ºche", en: "kitchen"},
                {de: "interessant", en: "interesting"},
                {de: "er/sie/es hat", en: "he/she/it has"},
                {de: "das Erdgeschoss", en: "ground floor"},
                {de: "der (Erd-) Boden", en: "ground"},
                {de: "der Garten", en: "garden"},
                {de: "die Garage", en: "garage"},
                {de: "die Etage, der Stock, das Stockwerk; der Fu√üboden", en: "floor"},
                {de: "die Wohnung", en: "the flat"},
                {de: "schnell", en: "fast"},
                {de: "jede", en: "each"},
                {de: "tr√§umen", en: "dream (verb)"},
                {de: "der Traum", en: "dream (noun)"},
                {de: "das Esszimmer", en: "dining room"},
                {de: "niedlich, s√º√ü", en: "cute"},
                {de: "das Schlafzimmer", en: "bedroom"},
                {de: "das Bad", en: "bathroom"},
                {de: "der Balkon", en: "balcony"},
                {de: "aktiv", en: "active"},
                {de: "ein Rundgang / eine Rundfahrt/ eine Reise durch Brighton", en: "a tour of Brighton"}
            ],
            list9: [
                {de: "der Kleiderschrank", en: "wardrobe"},
                {de: "die Wand, die Mauer", en: "wall"},
                {de: "unter", en: "under"},
                {de: "aufr√§umen", en: "tidy (verb)"},
                {de: "ordentlich", en: "tidy (adj)"},
                {de: "der Tisch", en: "table"},
                {de: "die Bonbons, die S√º√üigkeiten", en: "sweets"},
                {de: "s√º√ü", en: "sweet"},
                {de: "das Regal, die Regale", en: "shelf, pl shelves"},
                {de: "der Roboter", en: "robot"},
                {de: "die Person", en: "person"},
                {de: "an der Wand; an die Wand", en: "on the wall"},
                {de: "neben", en: "next to"},
                {de: "mein/ein eigenes Zimmer", en: "my own room"},
                {de: "der Spiegel", en: "mirror"},
                {de: "sein Terrarium / ihr Terrarium", en: "its terrarium"},
                {de: "vor", en: "in front of"},
                {de: "ins Bett gehen", en: "go to bed"},
                {de: "die T√ºr", en: "door"},
                {de: "Hast du ein eigenes Zimmer?", en: "Do you have your own room?"},
                {de: "das Kissen", en: "cushion"},
                {de: "die Kleidung, die Kleidungsst√ºcke", en: "clothes"},
                {de: "die Schokolade", en: "chocolate"},
                {de: "hinter", en: "behind"},
                {de: "das Bett", en: "bed"},
                {de: "der Stuhl", en: "chair"},
                {de: "Ihre gesamte Kleidung ist schwarz.", en: "All her clothes are black."}
            ]
        };

        let vocabulary = vocabularyLists.list8; // Default to list 8

        let gameState = {
            level: 1,
            xp: 0,
            score: 0,
            streak: 0,
            direction: 'de-en',
            spellDirection: 'de-en',
            flashDirection: 'de-en',
            currentMatches: [],
            userMatches: {},
            currentSpellWord: null,
            userAnswer: [],
            flashcardDeck: [],
            currentCardIndex: 0,
            cardFlipped: false,
            badges: {
                firstMatch: false,
                perfectRound: false,
                streak5: false,
                streak10: false,
                streak20: false,
                level5: false,
                level10: false,
                master: false,
                speedster: false,
                flashMaster: false,
                polyglot: false,
                dedication: false
            }
        };

        function init() {
            loadGameState();
            updateStats();
            initBadges();
            // Set first button as active and show match game
            document.querySelector('.game-mode-btn').classList.add('active');
            document.getElementById('matchGame').classList.add('active');
            newMatchRound();
        }

        function selectGameMode(mode, clickedBtn) {
            document.querySelectorAll('.game-mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.game-area').forEach(area => area.classList.remove('active'));
            
            if (clickedBtn) {
                clickedBtn.classList.add('active');
            }
            
            if (mode === 'match') {
                document.getElementById('matchGame').classList.add('active');
                newMatchRound();
            } else if (mode === 'spell') {
                document.getElementById('spellGame').classList.add('active');
                nextSpellingWord();
            } else if (mode === 'flashcard') {
                document.getElementById('flashcardGame').classList.add('active');
                initFlashcards();
            }
        }

        function setDirection(dir, clickedBtn) {
            gameState.direction = dir;
            document.querySelectorAll('#matchGame .toggle-btn').forEach(btn => btn.classList.remove('active'));
            if (clickedBtn) {
                clickedBtn.classList.add('active');
            }
            newMatchRound();
        }

        function setSpellDirection(dir, clickedBtn) {
            gameState.spellDirection = dir;
            document.querySelectorAll('#spellGame .toggle-btn').forEach(btn => btn.classList.remove('active'));
            if (clickedBtn) {
                clickedBtn.classList.add('active');
            }
            nextSpellingWord();
        }

        function newMatchRound() {
            const numWords = Math.min(5 + Math.floor(gameState.level / 3), 8);
            const shuffled = [...vocabulary].sort(() => Math.random() - 0.5);
            gameState.currentMatches = shuffled.slice(0, numWords);
            gameState.userMatches = {};
            
            renderMatchGame();
        }

        function renderMatchGame() {
            const area = document.getElementById('matchGameArea');
            const isDeToEn = gameState.direction === 'de-en';
            
            // Words to drag from (right side)
            const draggableWords = gameState.currentMatches.map((w, i) => ({
                word: isDeToEn ? w.en : w.de,
                correctMatch: isDeToEn ? w.de : w.en,
                index: i
            }));
            
            // Drop targets (left side, scrambled)
            const dropTargets = [...gameState.currentMatches]
                .sort(() => Math.random() - 0.5)
                .map((w, i) => ({
                    word: isDeToEn ? w.de : w.en,
                    index: i
                }));
            
            area.innerHTML = `
                <div class="column">
                    <div class="column-title">${isDeToEn ? 'üá©üá™ German' : 'üá¨üáß English'}</div>
                    ${dropTargets.map((item, i) => `
                        <div class="drop-zone" 
                             data-target="${item.word}"
                             ondrop="drop(event)" 
                             ondragover="allowDrop(event)" 
                             ondragleave="dragLeave(event)">
                            ${item.word}
                        </div>
                    `).join('')}
                </div>
                <div class="column">
                    <div class="column-title">${isDeToEn ? 'üá¨üáß English' : 'üá©üá™ German'} <small>‚Üê Drag these</small></div>
                    ${draggableWords.map((item, i) => `
                        <div class="word-item" 
                             draggable="true" 
                             data-word="${item.word}"
                             data-correct="${item.correctMatch}"
                             data-index="${item.index}" 
                             ondragstart="dragStart(event)">
                            ${item.word}
                        </div>
                    `).join('')}
                </div>
            `;
            
            gameState.userMatches = {};
            document.getElementById('matchFeedback').style.display = 'none';
        }

        function dragStart(e) {
            const word = e.target.dataset.word;
            const correct = e.target.dataset.correct;
            e.dataTransfer.setData('word', word);
            e.dataTransfer.setData('correct', correct);
            e.target.classList.add('dragging');
        }

        function allowDrop(e) {
            e.preventDefault();
            e.target.classList.add('drag-over');
        }

        function dragLeave(e) {
            e.target.classList.remove('drag-over');
        }

        function drop(e) {
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            const draggedWord = e.dataTransfer.getData('word');
            const correctAnswer = e.dataTransfer.getData('correct');
            const draggedElement = document.querySelector(`.word-item[data-word="${draggedWord}"]`);
            const dropZone = e.target.closest('.drop-zone');
            
            if (dropZone && draggedElement && !dropZone.classList.contains('filled')) {
                const targetWord = dropZone.dataset.target;
                
                // Store the match
                gameState.userMatches[targetWord] = draggedWord;
                
                // Visual feedback
                dropZone.classList.add('filled');
                dropZone.style.background = 'linear-gradient(135deg, #e0e7ff, #f0e7ff)';
                dropZone.style.borderColor = '#667eea';
                dropZone.style.borderStyle = 'solid';
                dropZone.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 0 10px;">
                        <span style="color: #666;">${targetWord}</span>
                        <span style="color: #667eea; font-weight: bold;">= ${draggedWord}</span>
                    </div>
                `;
                
                // Hide the dragged word
                draggedElement.style.opacity = '0.3';
                draggedElement.style.cursor = 'not-allowed';
                draggedElement.draggable = false;
            }
            
            document.querySelectorAll('.word-item').forEach(item => {
                item.classList.remove('dragging');
            });
        }

        function checkMatches() {
            let correct = 0;
            let total = 0;
            
            document.querySelectorAll('.drop-zone').forEach(zone => {
                const targetWord = zone.dataset.target;
                const userAnswer = gameState.userMatches[targetWord];
                
                if (userAnswer) {
                    total++;
                    
                    // Find the correct answer for this target
                    const isDeToEn = gameState.direction === 'de-en';
                    const pair = gameState.currentMatches.find(p => 
                        (isDeToEn ? p.de : p.en) === targetWord
                    );
                    const correctAnswer = pair ? (isDeToEn ? pair.en : pair.de) : null;
                    
                    if (userAnswer === correctAnswer) {
                        correct++;
                        zone.style.background = '#d4edda';
                        zone.style.borderColor = '#28a745';
                        zone.classList.remove('incorrect');
                        createSparkles(zone);
                    } else {
                        zone.style.background = '#f8d7da';
                        zone.style.borderColor = '#dc3545';
                        zone.classList.add('incorrect');
                        setTimeout(() => zone.classList.remove('incorrect'), 500);
                    }
                }
            });
            
            const feedback = document.getElementById('matchFeedback');
            if (correct === gameState.currentMatches.length && total === gameState.currentMatches.length) {
                feedback.className = 'feedback correct';
                feedback.textContent = `üéâ Perfect! All ${total} matches correct! +${total * 20} XP`;
                gameState.streak++;
                addXP(total * 20);
                
                // Confetti celebration!
                createConfetti();
                
                if (!gameState.badges.firstMatch) {
                    unlockBadge('firstMatch');
                }
                unlockBadge('perfectRound');
                if (gameState.streak >= 5) {
                    unlockBadge('streak5');
                }
                if (gameState.streak >= 10) {
                    unlockBadge('streak10');
                }
                if (gameState.streak >= 20) {
                    unlockBadge('streak20');
                }
            } else if (total === 0) {
                feedback.className = 'feedback incorrect';
                feedback.textContent = '‚ùå Please match all words before checking!';
            } else {
                feedback.className = 'feedback incorrect';
                feedback.textContent = `${correct}/${total} correct. Keep trying! üí™`;
                gameState.streak = 0;
            }
            
            updateStats();
            saveGameState();
        }

        function resetMatchGame() {
            renderMatchGame();
        }

        function nextSpellingWord() {
            const word = vocabulary[Math.floor(Math.random() * vocabulary.length)];
            gameState.currentSpellWord = word;
            gameState.userAnswer = [];
            
            const isDeToEn = gameState.spellDirection === 'de-en';
            const prompt = isDeToEn ? word.de : word.en;
            const answer = isDeToEn ? word.en : word.de;
            
            document.getElementById('wordPrompt').textContent = prompt;
            
            // Create scrambled letters
            const letters = answer.replace(/[^a-zA-Z√§√∂√º√ü√Ñ√ñ√ú]/g, '').split('');
            const scrambled = letters.sort(() => Math.random() - 0.5);
            
            const letterBank = document.getElementById('letterBank');
            letterBank.innerHTML = scrambled.map((letter, i) => 
                `<div class="letter-tile" draggable="true" data-letter="${letter}" data-id="${i}" ondragstart="dragLetter(event)" onclick="addLetter('${letter}', ${i})">${letter}</div>`
            ).join('');
            
            document.getElementById('answerArea').innerHTML = '';
            document.getElementById('spellFeedback').style.display = 'none';
        }

        function dragLetter(e) {
            e.dataTransfer.setData('letter', e.target.dataset.letter);
            e.dataTransfer.setData('id', e.target.dataset.id);
        }

        function addLetter(letter, id) {
            const tile = document.querySelector(`.letter-tile[data-id="${id}"]`);
            if (tile.classList.contains('used')) return;
            
            tile.classList.add('used');
            gameState.userAnswer.push({letter, id});
            
            renderAnswer();
        }

        function renderAnswer() {
            const answerArea = document.getElementById('answerArea');
            answerArea.innerHTML = gameState.userAnswer.map((item, i) => 
                `<div class="answer-slot filled" onclick="removeLetter(${i})">${item.letter}</div>`
            ).join('');
        }

        function removeLetter(index) {
            const removed = gameState.userAnswer.splice(index, 1)[0];
            const tile = document.querySelector(`.letter-tile[data-id="${removed.id}"]`);
            tile.classList.remove('used');
            renderAnswer();
        }

        function clearSpelling() {
            gameState.userAnswer = [];
            document.querySelectorAll('.letter-tile').forEach(tile => tile.classList.remove('used'));
            renderAnswer();
        }

        function checkSpelling() {
            const isDeToEn = gameState.spellDirection === 'de-en';
            const correctAnswer = (isDeToEn ? gameState.currentSpellWord.en : gameState.currentSpellWord.de)
                .replace(/[^a-zA-Z√§√∂√º√ü√Ñ√ñ√ú]/g, '').toLowerCase();
            const userAnswer = gameState.userAnswer.map(item => item.letter).join('').toLowerCase();
            
            const feedback = document.getElementById('spellFeedback');
            
            if (userAnswer === correctAnswer) {
                feedback.className = 'feedback correct';
                feedback.textContent = 'üéâ Correct! +30 XP';
                gameState.streak++;
                addXP(30);
                
                // Fun effects!
                createSparkles(document.getElementById('answerArea'));
                if (gameState.streak >= 3) {
                    createConfetti();
                }
                
                if (gameState.streak >= 5) unlockBadge('streak5');
                if (gameState.streak >= 10) unlockBadge('streak10');
            } else {
                feedback.className = 'feedback incorrect';
                feedback.textContent = `‚ùå Incorrect. The answer was: ${isDeToEn ? gameState.currentSpellWord.en : gameState.currentSpellWord.de}`;
                gameState.streak = 0;
            }
            
            updateStats();
            saveGameState();
        }

        function addXP(amount) {
            gameState.xp += amount;
            gameState.score += amount;
            
            // Check for dedication badge
            if (gameState.score >= 1000) {
                unlockBadge('dedication');
            }
            
            const xpNeeded = 100 * gameState.level;
            
            if (gameState.xp >= xpNeeded) {
                gameState.xp -= xpNeeded;
                gameState.level++;
                
                createConfetti();
                showCelebration(`üéä Level Up! You are now Level ${gameState.level}! üéä`);
                
                if (gameState.level >= 5) unlockBadge('level5');
                if (gameState.level >= 10) unlockBadge('level10');
                if (gameState.level >= 20) unlockBadge('master');
            }
            
            updateStats();
        }

        function updateStats() {
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('xp').textContent = gameState.xp;
            document.getElementById('xpNeeded').textContent = 100 * gameState.level;
            document.getElementById('score').textContent = gameState.score;
            document.getElementById('streak').textContent = gameState.streak;
            
            const progress = (gameState.xp / (100 * gameState.level)) * 100;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';
        }

        function initBadges() {
            const badgeData = [
                {id: 'firstMatch', emoji: 'üéØ', name: 'First Match', desc: 'Complete your first match game'},
                {id: 'perfectRound', emoji: 'üíØ', name: 'Perfect!', desc: 'Get all matches correct'},
                {id: 'streak5', emoji: 'üî•', name: 'Hot Streak', desc: 'Get 5 in a row correct'},
                {id: 'streak10', emoji: '‚ö°', name: 'Unstoppable', desc: 'Get 10 in a row correct'},
                {id: 'streak20', emoji: 'üí•', name: 'Legendary', desc: 'Get 20 in a row correct'},
                {id: 'level5', emoji: '‚≠ê', name: 'Rising Star', desc: 'Reach level 5'},
                {id: 'level10', emoji: 'üåü', name: 'Superstar', desc: 'Reach level 10'},
                {id: 'master', emoji: 'üëë', name: 'Master', desc: 'Reach level 20'},
                {id: 'speedster', emoji: 'üöÄ', name: 'Speedster', desc: 'Complete a round quickly'},
                {id: 'flashMaster', emoji: 'üÉè', name: 'Flash Master', desc: 'Complete all flashcards'},
                {id: 'polyglot', emoji: 'üåç', name: 'Polyglot', desc: 'Practice both directions'},
                {id: 'dedication', emoji: 'üèÜ', name: 'Dedicated', desc: 'Score 1000+ points'}
            ];
            
            const display = document.getElementById('badgeDisplay');
            display.innerHTML = badgeData.map(badge => `
                <div class="badge ${gameState.badges[badge.id] ? 'unlocked' : 'locked'}" 
                     style="background: ${getBadgeColor(badge.id)}"
                     id="badge-${badge.id}">
                    ${badge.emoji}
                    <div class="badge-tooltip">${badge.name}: ${badge.desc}</div>
                </div>
            `).join('');
        }

        function getBadgeColor(id) {
            const colors = {
                firstMatch: 'linear-gradient(135deg, #667eea, #764ba2)',
                perfectRound: 'linear-gradient(135deg, #f093fb, #f5576c)',
                streak5: 'linear-gradient(135deg, #fa709a, #fee140)',
                streak10: 'linear-gradient(135deg, #30cfd0, #330867)',
                streak20: 'linear-gradient(135deg, #ff0844, #ffb199)',
                level5: 'linear-gradient(135deg, #a8edea, #fed6e3)',
                level10: 'linear-gradient(135deg, #ffecd2, #fcb69f)',
                master: 'linear-gradient(135deg, #ff9a56, #ff6a00)',
                speedster: 'linear-gradient(135deg, #96fbc4, #f9f586)',
                flashMaster: 'linear-gradient(135deg, #4facfe, #00f2fe)',
                polyglot: 'linear-gradient(135deg, #43e97b, #38f9d7)',
                dedication: 'linear-gradient(135deg, #fa709a, #fee140)'
            };
            return colors[id] || '#ddd';
        }

        function unlockBadge(badgeId) {
            if (!gameState.badges[badgeId]) {
                gameState.badges[badgeId] = true;
                const badge = document.getElementById(`badge-${badgeId}`);
                badge.classList.remove('locked');
                badge.classList.add('unlocked');
                saveGameState();
                
                setTimeout(() => {
                    showCelebration(`üéâ New Badge Unlocked! üéâ`);
                }, 500);
            }
        }

        function showCelebration(text) {
            document.getElementById('celebrationText').textContent = text;
            document.getElementById('celebration').classList.add('show');
            document.getElementById('overlay').classList.add('show');
        }

        function closeCelebration() {
            document.getElementById('celebration').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }

        function changeVocabList() {
            const selector = document.getElementById('listSelector');
            vocabulary = vocabularyLists[selector.value];
            
            // Reset current games
            newMatchRound();
            nextSpellingWord();
            initFlashcards();
        }

        function setFlashDirection(dir, clickedBtn) {
            gameState.flashDirection = dir;
            document.querySelectorAll('#flashcardGame .toggle-btn').forEach(btn => btn.classList.remove('active'));
            if (clickedBtn) {
                clickedBtn.classList.add('active');
            }
            initFlashcards();
        }

        function initFlashcards() {
            gameState.flashcardDeck = [...vocabulary].sort(() => Math.random() - 0.5);
            gameState.currentCardIndex = 0;
            gameState.cardFlipped = false;
            document.getElementById('totalCards').textContent = gameState.flashcardDeck.length;
            showCard();
        }

        function showCard() {
            if (gameState.currentCardIndex >= gameState.flashcardDeck.length) {
                document.getElementById('flashFeedback').className = 'feedback correct';
                document.getElementById('flashFeedback').textContent = 'üéâ You completed all cards! +100 XP';
                addXP(100);
                createConfetti();
                unlockBadge('flashMaster');
                setTimeout(() => initFlashcards(), 3000);
                return;
            }

            const card = gameState.flashcardDeck[gameState.currentCardIndex];
            const isDeToEn = gameState.flashDirection === 'de-en';
            
            document.getElementById('flashFront').textContent = isDeToEn ? card.de : card.en;
            document.getElementById('flashBack').textContent = isDeToEn ? card.en : card.de;
            document.getElementById('cardNumber').textContent = gameState.currentCardIndex + 1;
            
            // Reset flip
            document.getElementById('flashcardInner').classList.remove('flipped');
            gameState.cardFlipped = false;
            document.getElementById('flashFeedback').style.display = 'none';
        }

        function flipCard() {
            const inner = document.getElementById('flashcardInner');
            const isFlipped = inner.classList.contains('flipped');
            
            if (isFlipped) {
                inner.classList.remove('flipped');
                gameState.cardFlipped = false;
            } else {
                inner.classList.add('flipped');
                gameState.cardFlipped = true;
            }
            
            console.log('Card flipped:', gameState.cardFlipped);
        }

        function rateCard(rating) {
            console.log('rateCard called with:', rating);
            console.log('Card flipped:', gameState.cardFlipped);
            
            if (!gameState.cardFlipped) {
                const feedback = document.getElementById('flashFeedback');
                feedback.className = 'feedback incorrect';
                feedback.textContent = '‚ö†Ô∏è Flip the card first to see the answer!';
                feedback.style.display = 'block';
                return;
            }

            let xpGain = 0;
            let message = '';
            
            if (rating === 'wrong') {
                xpGain = 5;
                message = 'üìö Keep practicing! +5 XP';
                gameState.streak = 0;
            } else if (rating === 'hard') {
                xpGain = 10;
                message = 'üí™ Good effort! +10 XP';
                gameState.streak++;
            } else if (rating === 'good') {
                xpGain = 15;
                message = '‚ú® Excellent! +15 XP';
                gameState.streak++;
                createSparkles(document.getElementById('flashcard'));
            }
            
            addXP(xpGain);
            
            if (gameState.streak >= 5) unlockBadge('streak5');
            if (gameState.streak >= 10) unlockBadge('streak10');
            if (gameState.streak >= 20) unlockBadge('streak20');
            
            const feedback = document.getElementById('flashFeedback');
            feedback.className = 'feedback correct';
            feedback.textContent = message;
            feedback.style.display = 'block';
            
            gameState.currentCardIndex++;
            setTimeout(() => showCard(), 1500);
            
            updateStats();
            saveGameState();
        }

        function saveGameState() {
            localStorage.setItem('germanVocabGame', JSON.stringify(gameState));
        }

        function loadGameState() {
            const saved = localStorage.getItem('germanVocabGame');
            if (saved) {
                const loaded = JSON.parse(saved);
                gameState = {...gameState, ...loaded};
            }
        }

        // Confetti effect
        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#fa709a', '#fee140', '#30cfd0', '#96fbc4'];
            const confettiCount = 100;
            
            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.animationDuration = Math.random() * 2 + 2 + 's';
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 30);
            }
            
            // Add star burst in center
            createStarBurst();
        }

        function createStarBurst() {
            const stars = ['‚≠ê', '‚ú®', 'üåü', 'üí´', 'üéâ', 'üéä'];
            for (let i = 0; i < 12; i++) {
                const star = document.createElement('div');
                star.className = 'star-burst';
                star.textContent = stars[Math.floor(Math.random() * stars.length)];
                star.style.left = '50%';
                star.style.top = '50%';
                star.style.animationDelay = (i * 0.1) + 's';
                document.body.appendChild(star);
                
                setTimeout(() => star.remove(), 1500);
            }
        }

        function createSparkles(element) {
            const rect = element.getBoundingClientRect();
            const sparkleCount = 8;
            
            for (let i = 0; i < sparkleCount; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                
                const angle = (Math.PI * 2 * i) / sparkleCount;
                const distance = 30;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                sparkle.style.left = (rect.left + rect.width / 2) + 'px';
                sparkle.style.top = (rect.top + rect.height / 2) + 'px';
                sparkle.style.setProperty('--tx', tx + 'px');
                sparkle.style.setProperty('--ty', ty + 'px');
                
                document.body.appendChild(sparkle);
                
                setTimeout(() => sparkle.remove(), 1000);
            }
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>