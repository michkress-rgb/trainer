<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deutsch Klassenarbeit Trainer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root{
            --primary:#FF6B9D; --secondary:#FFA07A; --success:#98D8C8; --warning:#F7DC6F;
            --danger:#FF7675; --light:#FFF4E6; --dark:#2D3436; --purple:#A29BFE;
            --pink:#FD79A8; --blue:#74B9FF; --green:#55EFC4;
        }

        body{
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg,#667eea 0%,#764ba2 100%,#FFA07A 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh; padding: 20px;
        }
        @keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
        .container{max-width:1200px;margin:0 auto;background:white;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);overflow:hidden}
        .header{
            background: linear-gradient(135deg,var(--pink) 0%,var(--purple) 50%,var(--blue) 100%);
            color:white;padding:40px 30px;text-align:center;position:relative;overflow:hidden;
        }
        .header h1{font-size:2.8em;margin-bottom:10px;text-shadow:3px 3px 6px rgba(0,0,0,0.2);animation:bounceIn 0.8s}
        @keyframes bounceIn{0%{transform:scale(0.3);opacity:0}50%{transform:scale(1.05)}70%{transform:scale(0.9)}100%{transform:scale(1);opacity:1}}
        .header p{font-size:1.2em;opacity:0.95;animation:fadeIn 1s}
        @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:.95;transform:translateY(0)}}

        .grade-selector{
            display:flex;justify-content:center;gap:20px;padding:30px 20px;
            background: linear-gradient(135deg,#FFF4E6 0%,#FFE5E5 100%);
            position:relative;
        }
        .grade-selector::before{
            content:'';position:absolute;bottom:0;left:0;right:0;height:4px;
            background: linear-gradient(90deg,var(--pink),var(--purple),var(--blue),var(--green));
            background-size:300% 100%;animation:shimmer 3s linear infinite;
        }
        @keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
        .grade-btn{
            padding:20px 50px;font-size:1.3em;font-weight:bold;border:3px solid transparent;
            background:white;color:var(--purple);border-radius:20px;cursor:pointer;
            transition:all .3s cubic-bezier(0.68,-0.55,0.265,1.55);box-shadow:0 5px 15px rgba(0,0,0,0.1);
            position:relative;overflow:hidden;
        }
        .grade-btn:hover{
            transform:translateY(-8px) scale(1.05);box-shadow:0 10px 25px rgba(0,0,0,0.2);
            background: linear-gradient(135deg,var(--pink) 0%,var(--purple) 100%);color:white;
        }
        .grade-btn.active{
            background: linear-gradient(135deg,var(--blue) 0%,var(--green) 100%);color:white;
            transform:scale(1.1);animation:pulse 2s infinite;
        }
        @keyframes pulse{0%,100%{box-shadow:0 5px 15px rgba(0,0,0,0.2)}50%{box-shadow:0 10px 30px rgba(0,0,0,0.3),0 0 20px rgba(116,185,255,.5)}}

        .tabs{display:flex;background: linear-gradient(135deg,var(--purple) 0%,var(--pink) 100%);overflow-x:auto;box-shadow:0 4px 15px rgba(0,0,0,0.1)}
        .tab{padding:18px 28px;color:white;cursor:pointer;white-space:nowrap;border-bottom:4px solid transparent;font-weight:500;transition:.3s}
        .tab:hover{background:rgba(255,255,255,.15)}
        .tab.active{background:white;color:var(--purple);border-bottom-color:var(--green);font-weight:bold;box-shadow:inset 0 4px 8px rgba(0,0,0,0.1)}
        .content{padding:30px;min-height:500px}
        .tab-content{display:none}
        .tab-content.active{display:block;animation:fadeIn .4s}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

        .progress-section{
            background: linear-gradient(135deg,#FF6B9D 0%,#FFA07A 50%,#98D8C8 100%);
            padding:35px;border-radius:20px;margin-bottom:30px;color:white;box-shadow:0 10px 30px rgba(0,0,0,0.2);position:relative;overflow:hidden;
        }
        .progress-section::before{
            content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;
            background: repeating-linear-gradient(45deg,transparent,transparent 10px,rgba(255,255,255,0.05) 10px,rgba(255,255,255,0.05) 20px);
            animation:stripes 20s linear infinite;
        }
        @keyframes stripes{0%{transform:translate(0,0)}100%{transform:translate(50px,50px)}}
        .progress-meter{position:relative;width:320px;height:320px;margin:25px auto;z-index:1}
        .meter-circle{
            width:100%;height:100%;border-radius:50%;
            background: conic-gradient(var(--green) 0deg,var(--green) var(--progress-deg,0deg),rgba(255,255,255,0.25) var(--progress-deg,0deg));
            display:flex;align-items:center;justify-content:center;position:relative;
            box-shadow:0 15px 40px rgba(0,0,0,0.3), inset 0 5px 15px rgba(0,0,0,0.2);
            animation: hue 20s linear infinite;
        }
        @keyframes hue{from{filter:hue-rotate(0deg)}to{filter:hue-rotate(360deg)}}
        .meter-inner{width:80%;height:80%;background:white;border-radius:50%;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--primary)}
        .meter-percentage{font-size:3em;font-weight:bold}
        .meter-label{font-size:1.2em;margin-top:10px}
        .readiness-message{text-align:center;font-size:1.3em;margin-top:20px;font-weight:bold}

        .exercise-box{background:var(--light);padding:25px;border-radius:10px;margin-bottom:20px;border-left:5px solid var(--secondary)}
        .exercise-box h3{color:var(--primary);margin-bottom:15px;font-size:1.4em}
        .question{margin:20px 0;padding:15px;background:white;border-radius:8px;border:2px solid var(--light)}
        .question-text{font-size:1.1em;margin-bottom:15px;color:var(--dark);font-weight:500}

        .word-bank{display:flex;flex-wrap:wrap;gap:12px;margin:15px 0;padding:20px;background:linear-gradient(135deg,#FFF4E6 0%,#FFE5E5 100%);border-radius:15px;min-height:80px;border:3px dashed var(--pink);box-shadow:inset 0 2px 8px rgba(0,0,0,0.05)}
        .draggable-word{padding:10px 20px;background:linear-gradient(135deg,var(--blue) 0%,var(--purple) 100%);color:white;border-radius:12px;cursor:move;user-select:none;transition:.2s;font-weight:600;box-shadow:0 4px 12px rgba(0,0,0,0.15)}
        .draggable-word:hover{transform:scale(1.1) rotate(2deg);box-shadow:0 6px 18px rgba(0,0,0,0.25)}
        .draggable-word.dragging{opacity:.4;transform:scale(0.9)}

        .drop-zone{display:inline-block;min-width:120px;min-height:42px;padding:10px;margin:0 8px 8px 0;border:3px dashed var(--purple);border-radius:12px;background:white;vertical-align:middle;transition:.3s;position:relative}
        .drop-zone.drag-over{border-color:var(--green);background:linear-gradient(135deg,#E8F8F5 0%,#D4EDDA 100%);transform:scale(1.05);box-shadow:0 0 20px rgba(85,239,196,.5)}
        .drop-zone.filled{border-style:solid;background:linear-gradient(135deg,var(--pink) 0%,var(--secondary) 100%);color:white;font-weight:600;border-color:var(--pink);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
        .drop-zone.correct{border-color:var(--green);background:linear-gradient(135deg,#98D8C8 0%,#55EFC4 100%);animation:successPulse .5s}
        @keyframes successPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
        .drop-zone.incorrect{border-color:var(--danger);background:linear-gradient(135deg,#FF7675 0%,#FD79A8 100%);animation:shake .5s}
        @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}

        .clickable-word{display:inline-block;padding:4px 8px;margin:2px;cursor:pointer;border-radius:4px;transition:.2s}
        .clickable-word:hover{background:var(--light)}
        .clickable-word.selected{background:var(--warning);color:white}
        .clickable-word.correct{background:var(--success);color:white}
        .clickable-word.incorrect{background:var(--danger);color:white}

        .capitalize-word{display:inline-block;padding:4px 8px;margin:2px;cursor:pointer;border:2px solid transparent;border-radius:4px;transition:.2s}
        .capitalize-word:hover{border-color:var(--secondary);background:var(--light)}
        .capitalize-word.capitalized{font-weight:bold;color:var(--secondary)}

        .mcq-option{padding:15px;margin:10px 0;background:white;border:2px solid var(--light);border-radius:8px;cursor:pointer;transition:.3s}
        .mcq-option:hover{border-color:var(--secondary);background:var(--light)}
        .mcq-option.selected{border-color:var(--secondary);background:#e3f2fd}
        .mcq-option.correct{border-color:var(--success);background:#d4edda}
        .mcq-option.incorrect{border-color:var(--danger);background:#f8d7da}

        .btn{padding:14px 35px;font-size:1.1em;border:none;border-radius:25px;cursor:pointer;transition:.3s cubic-bezier(0.68,-0.55,0.265,1.55);font-weight:bold;box-shadow:0 5px 15px rgba(0,0,0,0.2);position:relative;overflow:hidden}
        .btn::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,0.5);transform:translate(-50%,-50%);transition:width .6s,height .6s}
        .btn:hover::before{width:300px;height:300px}
        .btn-primary{background:linear-gradient(135deg,var(--blue) 0%,var(--purple) 100%);color:white}
        .btn-primary:hover{background:linear-gradient(135deg,var(--purple) 0%,var(--pink) 100%);transform:translateY(-3px) scale(1.05);box-shadow:0 10px 25px rgba(0,0,0,0.3)}
        .btn-success{background:linear-gradient(135deg,var(--green) 0%,#55EFC4 100%);color:white}
        .btn-success:hover{background:linear-gradient(135deg,#55EFC4 0%,var(--blue) 100%);transform:translateY(-3px) scale(1.05)}

        .button-group{display:flex;gap:15px;margin-top:20px}
        .feedback{padding:15px;border-radius:8px;margin-top:15px;font-weight:bold}
        .feedback.correct{background:#d4edda;color:#155724;border:2px solid var(--success)}
        .feedback.incorrect{background:#f8d7da;color:#721c24;border:2px solid var(--danger)}
        .feedback.partial{background:#fff3cd;color:#856404;border:2px solid var(--warning)}

        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin:20px 0}
        .stat-card{background:white;padding:20px;border-radius:10px;text-align:center;box-shadow:0 3px 10px rgba(0,0,0,0.1)}
        .stat-number{font-size:2.5em;font-weight:bold;color:var(--secondary)}
        .stat-label{font-size:1em;color:var(--dark);margin-top:5px}

        .skills-table{width:100%;border-collapse:collapse;margin:20px 0}
        .skills-table th,.skills-table td{padding:15px;text-align:left;border-bottom:1px solid var(--light)}
        .skills-table th{background:var(--primary);color:white;font-weight:bold}
        .skills-table tr:hover{background:var(--light)}
        .skill-badge{display:inline-block;padding:5px 10px;border-radius:5px;font-size:.9em;font-weight:bold}
        .skill-beginner{background:#ffebee;color:#c62828}
        .skill-intermediate{background:#fff3e0;color:#ef6c00}
        .skill-advanced{background:#e8f5e9;color:#2e7d32}

        .survival-story{background:linear-gradient(135deg,#434343 0%,#000 100%);color:white;padding:25px;border-radius:10px;margin:20px 0}
        .survival-story h3{color:#ff6b6b;margin-bottom:15px}
        .sachtext-passage{background:#f8f9fa;padding:20px;border-left:4px solid var(--secondary);margin:20px 0;line-height:1.8;font-size:1.05em}

        .input-field{width:100%;padding:10px;border:2px solid var(--light);border-radius:6px;font-size:1em;margin:10px 0}
        .input-field:focus{outline:none;border-color:var(--secondary)}
        .download-section{background:var(--light);padding:20px;border-radius:10px;margin-top:20px}
        .progress-bar{width:100%;height:30px;background:var(--light);border-radius:15px;overflow:hidden;margin:10px 0}
        .progress-fill{height:100%;background:linear-gradient(90deg,var(--success),var(--secondary));transition:width .5s;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold}
        .grade-title{font-size:1.3em;font-weight:bold;color:var(--primary);margin-bottom:10px}

        @media (max-width:768px){
            .header h1{font-size:1.8em}
            .grade-selector{flex-direction:column}
            .progress-meter{width:200px;height:200px}
            .meter-percentage{font-size:2em}
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Deutsch Klassenarbeit Trainer</h1>
        <p>Intensive Vorbereitung</p>
    </div>

    <div class="grade-selector">
        <button class="grade-btn active" onclick="selectGrade(this,6)">Klasse 6</button>
        <button class="grade-btn" onclick="selectGrade(this,7)">Klasse 7</button>
        <button class="grade-btn" onclick="selectGrade(this,8)">Klasse 8</button>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab(this,'fortschritt')">Fortschritt</div>
        <div class="tab" onclick="switchTab(this,'kompetenzen')">Kompetenzen</div>
        <div class="tab" onclick="switchTab(this,'grammatik')">Grammatik</div>
        <div class="tab" onclick="switchTab(this,'fehlerkorrektur')">Fehlerkorrektur</div>
        <div class="tab" onclick="switchTab(this,'leseverstehen')">Leseverstehen</div>
        <div class="tab" onclick="switchTab(this,'sachtexte')">Sachtexte</div>
        <div class="tab" onclick="switchTab(this,'ueberlebensgeschichten')">Überlebensgeschichten</div>
        <div class="tab" onclick="switchTab(this,'ergebnisse')">Ergebnisse</div>
    </div>

    <div class="content">
        <!-- Fortschritt Tab -->
        <div id="fortschritt" class="tab-content active">
            <div class="progress-section">
                <h2 style="text-align:center;margin-bottom:20px;">Deine Prüfungsvorbereitung</h2>
                <div class="grade-title" id="gradeTitle">Klasse 6: Arbeitshilfe für die erste Klassenarbeit am 2. Dezember</div>

                <div class="progress-meter" id="progressMeter">
                    <div class="meter-circle">
                        <div class="meter-inner">
                            <div class="meter-percentage" id="meterPercentage">0%</div>
                            <div class="meter-label">bereit</div>
                        </div>
                    </div>
                </div>

                <div class="readiness-message" id="readinessMessage">Du musst noch viel üben!</div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalExercises">0</div>
                    <div class="stat-label">Übungen absolviert</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="correctAnswers">0</div>
                    <div class="stat-label">Richtige Antworten</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="accuracyRate">0%</div>
                    <div class="stat-label">Genauigkeit</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="weakestArea">—</div>
                    <div class="stat-label">Schwächster Bereich</div>
                </div>
            </div>

            <div class="exercise-box">
                <h3>Deine Fortschrittsbereiche</h3>
                <div class="progress-bar"><div class="progress-fill" id="grammarProgress" style="width:0%"></div></div><p>Grammatik</p>
                <div class="progress-bar"><div class="progress-fill" id="errorProgress" style="width:0%"></div></div><p>Fehlerkorrektur</p>
                <div class="progress-bar"><div class="progress-fill" id="readingProgress" style="width:0%"></div></div><p>Leseverstehen</p>
                <div class="progress-bar"><div class="progress-fill" id="survivalProgress" style="width:0%"></div></div><p>Überlebensgeschichten</p>
            </div>
        </div>

        <!-- Kompetenzen Tab -->
        <div id="kompetenzen" class="tab-content">
            <h2>Erwartete Kompetenzen</h2>
            <div id="kompetenzContent"></div>
        </div>

        <!-- Grammatik Tab -->
        <div id="grammatik" class="tab-content">
            <h2>Grammatik-Übungen</h2>
            <div id="grammatikContent"></div>
        </div>

        <!-- Fehlerkorrektur Tab -->
        <div id="fehlerkorrektur" class="tab-content">
            <h2>Fehlerkorrektur</h2>
            <div id="fehlerkorrekturContent"></div>
        </div>

        <!-- Leseverstehen Tab -->
        <div id="leseverstehen" class="tab-content">
            <h2>Leseverstehen</h2>
            <div id="leseContent"></div>
        </div>

        <!-- Sachtexte Tab -->
        <div id="sachtexte" class="tab-content">
            <h2>Sachtexte</h2>
            <div id="sachtexteContent"></div>
        </div>

        <!-- Überlebensgeschichten Tab -->
        <div id="ueberlebensgeschichten" class="tab-content">
            <div class="survival-story">
                <h2>Überlebensgeschichten: „Feuer machen" von Jack London</h2>
                <p>Hier testest du dein Wissen über die Kurzgeschichte und allgemeines Survival-Wissen.</p>
            </div>
            <div id="survivalContent"></div>
        </div>

        <!-- Ergebnisse Tab -->
        <div id="ergebnisse" class="tab-content">
            <h2>Deine Ergebnisse und Analyse</h2>
            <div id="ergebnisseContent"></div>
            <div class="download-section">
                <h3>Ergebnisse herunterladen</h3>
                <p>Lade eine detaillierte Analyse deiner Leistungen herunter.</p>
                <button class="btn btn-success" onclick="downloadResults()">TXT herunterladen</button>
            </div>
        </div>
    </div>
</div>

<script>
let currentGrade = 6;
let studentData = {
    grade: 6,
    exercises: {
        grammar: { attempted: 0, correct: 0 },
        error: { attempted: 0, correct: 0 },
        reading: { attempted: 0, correct: 0 },
        sachtext: { attempted: 0, correct: 0 },
        survival: { attempted: 0, correct: 0 }
    },
    completedExercises: []
};

// Load & Save
function loadData(){
    const saved = localStorage.getItem('deutschTrainerData');
    if(saved){
        studentData = JSON.parse(saved);
        currentGrade = studentData.grade || 6;
    }
}
function saveData(){ localStorage.setItem('deutschTrainerData', JSON.stringify(studentData)); }

// Grade selection (no implicit event)
function selectGrade(btn, grade){
    currentGrade = grade; studentData.grade = grade;

    document.querySelectorAll('.grade-btn').forEach(b=>b.classList.remove('active'));
    if(btn){ btn.classList.add('active'); }
    else{
        const match = Array.from(document.querySelectorAll('.grade-btn')).find(b=>b.textContent.includes(String(grade)));
        if(match) match.classList.add('active');
    }

    const titles = {
        6:'Klasse 6: Arbeitshilfe für die erste Klassenarbeit am 2. Dezember',
        7:'Klasse 7: Vorbereitung auf die Klassenarbeit',
        8:'Klasse 8: Intensive Prüfungsvorbereitung'
    };
    document.getElementById('gradeTitle').textContent = titles[grade];

    loadKompetenzContent();
    loadGrammatikContent();
    loadFehlerkorrekturContent();
    loadLeseContent();
    loadSachtexteContent();
    loadSurvivalContent();
    loadErgebnisseContent();
    saveData();
    updateAllStats();
}

// Tab switching (no implicit event)
function switchTab(tabEl, tabName){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
    tabEl.classList.add('active');
    document.getElementById(tabName).classList.add('active');
}

// Stats & meter
function updateAllStats(){
    const total = Object.values(studentData.exercises).reduce((s,c)=>s+c.attempted,0);
    const correct = Object.values(studentData.exercises).reduce((s,c)=>s+c.correct,0);
    const accuracy = total>0 ? Math.round((correct/total)*100) : 0;

    document.getElementById('totalExercises').textContent = total;
    document.getElementById('correctAnswers').textContent = correct;
    document.getElementById('accuracyRate').textContent = accuracy + '%';

    let weakest='—',lowest=100;
    Object.entries(studentData.exercises).forEach(([k,d])=>{
        if(d.attempted>0){
            const score=(d.correct/d.attempted)*100;
            if(score<lowest){lowest=score;weakest=k;}
        }
    });
    const areaNames={grammar:'Grammatik',error:'Fehlerkorrektur',reading:'Lesen',sachtext:'Sachtexte',survival:'Survival'};
    document.getElementById('weakestArea').textContent = areaNames[weakest] || '—';

    updateProgressBar('grammarProgress', studentData.exercises.grammar);
    updateProgressBar('errorProgress', studentData.exercises.error);
    updateProgressBar('readingProgress', studentData.exercises.reading);
    updateProgressBar('survivalProgress', studentData.exercises.survival);

    updateReadinessMeter(accuracy);
}
function updateProgressBar(id,data){
    const el=document.getElementById(id); if(!el) return;
    const pct = data.attempted>0 ? Math.round((data.correct/data.attempted)*100) : 0;
    el.style.width = pct+'%'; el.textContent = pct+'%';
}
function updateReadinessMeter(percentage){
    const meterPercentage=document.getElementById('meterPercentage');
    const readinessMessage=document.getElementById('readinessMessage');
    const meterCircle=document.querySelector('.meter-circle');
    meterPercentage.textContent = percentage + '%';
    const deg=(percentage/100)*360;
    meterCircle.style.setProperty('--progress-deg', deg + 'deg');
    if(percentage<40){ readinessMessage.textContent='Sehr viel Übung nötig! Arbeite systematisch an deinen Schwächen.'; readinessMessage.style.color='#e74c3c'; }
    else if(percentage<60){ readinessMessage.textContent='Noch nicht ausreichend. Übe weiter, besonders die schwierigen Bereiche!'; readinessMessage.style.color='#f39c12'; }
    else if(percentage<75){ readinessMessage.textContent='Guter Fortschritt, aber du kannst noch besser werden!'; readinessMessage.style.color='#3498db'; }
    else if(percentage<90){ readinessMessage.textContent='Sehr gut! Du bist fast bereit. Wiederhole noch einmal die schwierigen Themen.'; readinessMessage.style.color='#27ae60'; }
    else { readinessMessage.textContent='Ausgezeichnet! Du bist gut vorbereitet. Bleib konzentriert!'; readinessMessage.style.color='#27ae60'; }
}

// Kompetenzen
function loadKompetenzContent(){
    const content=document.getElementById('kompetenzContent');
    const kompetenzen={
        6:{title:'Klasse 6 (Stage 7 – A1 CEFR)',skills:[
            {area:'Hören & Lesen',desc:'Hauptidee und Details in kurzen, vertrauten Texten verstehen',level:'beginner'},
            {area:'Schreiben & Grammatik',desc:'Kurze, korrekte Sätze über sich selbst, Familie, Schule schreiben',level:'beginner'},
            {area:'Schreiben & Grammatik',desc:'Großschreibung von Nomen korrekt anwenden',level:'beginner'},
            {area:'Schreiben & Grammatik',desc:'Grundlegende Verbkonjugationen (sein, haben, wohnen, gehen, spielen)',level:'beginner'},
            {area:'Schreiben & Grammatik',desc:'Verb-Zweit-Stellung im Hauptsatz beherrschen',level:'intermediate'},
            {area:'Fehlerkorrektur',desc:'Einen Grammatik- oder Großschreibungsfehler identifizieren',level:'intermediate'},
            {area:'Sprechen',desc:'Kurze Selbstvorstellung und Beschreibung vertrauter Dinge',level:'beginner'}
        ]},
        7:{title:'Klasse 7 (Stage 8 – A1+ bis A2 CEFR)',skills:[
            {area:'Hören & Lesen',desc:'Hauptideen und Meinungen in kurzen Texten verstehen',level:'intermediate'},
            {area:'Schreiben & Grammatik',desc:'Verknüpfte Sätze und kurze Absätze über Schule, Freizeit schreiben',level:'intermediate'},
            {area:'Schreiben & Grammatik',desc:'Präsens und Futur I korrekt verwenden',level:'intermediate'},
            {area:'Schreiben & Grammatik',desc:'weil + Verb-End-Stellung richtig anwenden',level:'intermediate'},
            {area:'Schreiben & Grammatik',desc:'Konnektoren für Ursache und Reihenfolge nutzen',level:'intermediate'},
            {area:'Fehlerkorrektur',desc:'Mehrere Fehler in Zeitform, Wortstellung oder Konnektoren erkennen',level:'advanced'},
            {area:'Sprechen',desc:'Kurze Dialoge führen; Meinungen äußern und begründen',level:'intermediate'}
        ]},
        8:{title:'Klasse 8 (Stage 9 – A2 CEFR)',skills:[
            {area:'Hören & Lesen',desc:'Details, Meinungen und Abfolgen in authentischen Texten verstehen',level:'advanced'},
            {area:'Schreiben & Grammatik',desc:'Zusammenhängende Absätze (E-Mails, Tagebucheinträge) schreiben',level:'advanced'},
            {area:'Schreiben & Grammatik',desc:'Präsens, Perfekt, Präteritum und Futur I korrekt einsetzen',level:'advanced'},
            {area:'Schreiben & Grammatik',desc:'Korrekte Wortstellung in Haupt- und Nebensätzen',level:'advanced'},
            {area:'Schreiben & Grammatik',desc:'Vielfältige Konnektoren verwenden (zuerst, dann, obwohl)',level:'advanced'},
            {area:'Fehlerkorrektur',desc:'Absatz mit gemischten Fehlern editieren und neu schreiben',level:'advanced'},
            {area:'Sprechen',desc:'Ausführliche Gespräche über Erfahrungen und Pläne führen',level:'advanced'}
        ]}
    };
    const gradeData=kompetenzen[currentGrade];
    let html=`<h3>${gradeData.title}</h3>`;
    html+='<table class="skills-table"><thead><tr><th>Bereich</th><th>Kompetenz</th><th>Niveau</th></tr></thead><tbody>';
    gradeData.skills.forEach(skill=>{
        const badgeClass=`skill-${skill.level}`;
        const levelText={beginner:'Grundlegend',intermediate:'Fortgeschritten',advanced:'Erweitert'};
        html+=`<tr><td><strong>${skill.area}</strong></td><td>${skill.desc}</td><td><span class="skill-badge ${badgeClass}">${levelText[skill.level]}</span></td></tr>`;
    });
    html+='</tbody></table>';
    content.innerHTML=html;
}

// Grammatik
function loadGrammatikContent(){
    const content=document.getElementById('grammatikContent');
    let html='';
    if(currentGrade===6){ html+=createGrammarExercise6(); }
    else if(currentGrade===7){ html+=createGrammarExercise7(); }
    else { html+=createGrammarExercise8(); }
    content.innerHTML=html;
    initializeDragAndDrop();
}
function createGrammarExercise6(){
    return `
    <div class="exercise-box">
        <h3>Übung 1: Relativsätze und Verbformen</h3>
        <div class="question">
            <p class="question-text">Ergänze die Relativpronomen und setze die Verben in der richtigen Zeitform ein:</p>
            <p>Der Mann, <span class="drop-zone" data-answer="den"></span> ich gestern <span class="drop-zone" data-answer="sah"></span>, ist mein Nachbar.
               Das Buch, <span class="drop-zone" data-answer="das"></span> auf dem Tisch <span class="drop-zone" data-answer="liegt"></span>, gehört meiner Schwester.</p>
            <div class="word-bank" id="bank1">
                <div class="draggable-word">der</div>
                <div class="draggable-word">den</div>
                <div class="draggable-word">das</div>
                <div class="draggable-word">sah</div>
                <div class="draggable-word">sehen</div>
                <div class="draggable-word">liegt</div>
                <div class="draggable-word">legen</div>
            </div>
            <button class="btn btn-primary" onclick="checkGrammarAnswers(this,'grammar')">Prüfen</button>
        </div>
    </div>

    <div class="exercise-box">
        <h3>Übung 2: Höflichkeit mit Konjunktiv II</h3>
        <div class="question">
            <p class="question-text">Formuliere die Sätze höflicher:</p>
            <p>1. Kannst du mir helfen? → <span class="drop-zone" data-answer="Könntest"></span> du mir helfen?</p>
            <p>2. Haben Sie Zeit? → <span class="drop-zone" data-answer="Hätten"></span> Sie Zeit?</p>
            <div class="word-bank" id="bank2">
                <div class="draggable-word">Könntest</div>
                <div class="draggable-word">Könnten</div>
                <div class="draggable-word">Hätten</div>
                <div class="draggable-word">Hatten</div>
            </div>
            <button class="btn btn-primary" onclick="checkGrammarAnswers(this,'grammar')">Prüfen</button>
        </div>
    </div>`;
}
function createGrammarExercise7(){
    return `
    <div class="exercise-box">
        <h3>Übung 1: Nebensätze mit weil</h3>
        <div class="question">
            <p class="question-text">Verbinde die Sätze mit "weil" (Verb am Ende):</p>
            <p>Ich bleibe zu Hause, weil ich <span class="drop-zone" data-answer="krank"></span> <span class="drop-zone" data-answer="bin"></span>.</p>
            <p>Sie lernt viel, weil sie gute Noten <span class="drop-zone" data-answer="bekommen"></span> <span class="drop-zone" data-answer="möchte"></span>.</p>
            <div class="word-bank" id="bank3">
                <div class="draggable-word">krank</div>
                <div class="draggable-word">bin</div>
                <div class="draggable-word">ist</div>
                <div class="draggable-word">bekommen</div>
                <div class="draggable-word">möchte</div>
                <div class="draggable-word">will</div>
            </div>
            <button class="btn btn-primary" onclick="checkGrammarAnswers(this,'grammar')">Prüfen</button>
        </div>
    </div>

    <div class="exercise-box">
        <h3>Übung 2: Präteritum</h3>
        <div class="question">
            <p class="question-text">Setze die Verben ins Präteritum:</p>
            <p>Gestern <span class="drop-zone" data-answer="ging"></span> ich ins Kino. Der Film <span class="drop-zone" data-answer="war"></span> sehr spannend. Wir <span class="drop-zone" data-answer="hatten"></span> viel Spaß.</p>
            <div class="word-bank" id="bank4">
                <div class="draggable-word">ging</div><div class="draggable-word">gehe</div>
                <div class="draggable-word">war</div><div class="draggable-word">ist</div>
                <div class="draggable-word">hatten</div><div class="draggable-word">haben</div>
            </div>
            <button class="btn btn-primary" onclick="checkGrammarAnswers(this,'grammar')">Prüfen</button>
        </div>
    </div>`;
}
function createGrammarExercise8(){
    return `
    <div class="exercise-box">
        <h3>Übung 1: Passiv</h3>
        <div class="question">
            <p class="question-text">Forme in Passiv um:</p>
            <p>Die Schüler schreiben einen Test. → Ein Test <span class="drop-zone" data-answer="wird"></span> <span class="drop-zone" data-answer="geschrieben"></span>.</p>
            <p>Der Autor veröffentlichte das Buch. → Das Buch <span class="drop-zone" data-answer="wurde"></span> <span class="drop-zone" data-answer="veröffentlicht"></span>.</p>
            <div class="word-bank" id="bank5">
                <div class="draggable-word">wird</div>
                <div class="draggable-word">wurde</div>
                <div class="draggable-word">geschrieben</div>
                <div class="draggable-word">veröffentlicht</div>
                <div class="draggable-word">schreiben</div>
            </div>
            <button class="btn btn-primary" onclick="checkGrammarAnswers(this,'grammar')">Prüfen</button>
        </div>
    </div>

    <div class="exercise-box">
        <h3>Übung 2: Komplexe Nebensätze</h3>
        <div class="question">
            <p class="question-text">Ergänze Konjunktionen und Verbformen:</p>
            <p><span class="drop-zone" data-answer="Obwohl"></span> es regnete, gingen wir spazieren, <span class="drop-zone" data-answer="weil"></span> wir frische Luft <span class="drop-zone" data-answer="brauchten"></span>.</p>
            <div class="word-bank" id="bank6">
                <div class="draggable-word">Obwohl</div>
                <div class="draggable-word">Weil</div>
                <div class="draggable-word">weil</div>
                <div class="draggable-word">brauchten</div>
                <div class="draggable-word">brauchen</div>
            </div>
            <button class="btn btn-primary" onclick="checkGrammarAnswers(this,'grammar')">Prüfen</button>
        </div>
    </div>`;
}

// Fehlerkorrektur
function loadFehlerkorrekturContent(){
    const content=document.getElementById('fehlerkorrekturContent');
    let html='';
    if(currentGrade===6){
        html = `
        <div class="exercise-box">
            <h3>Finde die Fehler (klicke auf fehlerhafte Wörter)</h3>
            <div class="question">
                <p class="question-text">Klicke auf alle Wörter mit Fehlern:</p>
                <p id="errorText1">
                    ${createClickableText('Obwohl', false)}
                    ${createClickableText('es', false)}
                    ${createClickableText('gestern', false)}
                    ${createClickableText('stark', false)}
                    ${createClickableText('geregnet', false)}
                    ${createClickableText('hat', false)}
                    ${createClickableText('wir', false)}
                    ${createClickableText('trotzdem', false)}
                    ${createClickableText('spazieren', false)}
                    ${createClickableText('gegangen', false)}.
                    ${createClickableText('Mein', false)}
                    ${createClickableText('bruder', true)}
                    ${createClickableText('meinte', false)}
                    ${createClickableText('das', true)}
                    ${createClickableText('es', false)}
                    ${createClickableText('zu', false)}
                    ${createClickableText('kalt', false)}
                    ${createClickableText('währe', true)}.
                </p>
                <button class="btn btn-primary" onclick="checkErrorCorrection(this,'error')">Prüfen</button>
            </div>
        </div>

        <div class="exercise-box">
            <h3>Großschreibung korrigieren</h3>
            <div class="question">
                <p class="question-text">Klicke auf alle Wörter, die großgeschrieben werden müssen:</p>
                <p id="capText1">
                    ${createCapitalizeText('beim', false)}
                    ${createCapitalizeText('turnen', true)}
                    ${createCapitalizeText('habe', false)}
                    ${createCapitalizeText('ich', false)}
                    ${createCapitalizeText('mir', false)}
                    ${createCapitalizeText('gestern', false)}
                    ${createCapitalizeText('abend', true)}
                    ${createCapitalizeText('den', false)}
                    ${createCapitalizeText('fuß', true)}
                    ${createCapitalizeText('verstaucht', false)}.
                </p>
                <button class="btn btn-primary" onclick="checkCapitalization(this,'error')">Prüfen</button>
            </div>
        </div>`;
    } else if(currentGrade===7){
        html = `
        <div class="exercise-box">
            <h3>Satzbau-Fehler finden</h3>
            <div class="question">
                <p class="question-text">Finde alle Fehler (Satzbau, Rechtschreibung, Großschreibung):</p>
                <p id="errorText2">
                    ${createClickableText('Als', false)}
                    ${createClickableText('ich', false)}
                    ${createClickableText('in', false)}
                    ${createClickableText('die', false)}
                    ${createClickableText('schule', true)}
                    ${createClickableText('gekommen', false)}
                    ${createClickableText('bin', false)},
                    ${createClickableText('die', true)}
                    ${createClickableText('Lehrerin', false)}
                    ${createClickableText('hat', true)}
                    ${createClickableText('schon', false)}
                    ${createClickableText('mit', false)}
                    ${createClickableText('dem', false)}
                    ${createClickableText('Unterricht', false)}
                    ${createClickableText('angefangen', false)}.
                    ${createClickableText('Sie', false)}
                    ${createClickableText('meinte', false)},
                    ${createClickableText('ich', false)}
                    ${createClickableText('sollte', false)}
                    ${createClickableText('früher', false)}
                    ${createClickableText('aufgestanden', true)}.
                </p>
                <button class="btn btn-primary" onclick="checkErrorCorrection(this,'error')">Prüfen</button>
            </div>
        </div>`;
    } else {
        html = `
        <div class="exercise-box">
            <h3>Komplexe Fehlerkorrektur</h3>
            <div class="question">
                <p class="question-text">Finde alle Fehler in diesem Absatz (Zeitformen, Satzbau, Stil):</p>
                <p id="errorText3">
                    ${createClickableText('Mein', false)}
                    ${createClickableText('Opa', false)}
                    ${createClickableText('erzählt', false)}
                    ${createClickableText('oft', false)}
                    ${createClickableText('stories', true)}
                    ${createClickableText('aus', false)}
                    ${createClickableText('seiner', false)}
                    ${createClickableText('Kindheit', false)}.
                    ${createClickableText('Er', false)}
                    ${createClickableText('ist', false)}
                    ${createClickableText('in', false)}
                    ${createClickableText('einem', false)}
                    ${createClickableText('kleinen', false)}
                    ${createClickableText('village', true)}
                    ${createClickableText('aufgewachsen', false)},
                    ${createClickableText('wo', false)}
                    ${createClickableText('alle', false)}
                    ${createClickableText('sich', false)}
                    ${createClickableText('gegenseitig', false)}
                    ${createClickableText('kannten', false)}.
                    ${createClickableText('Die', false)}
                    ${createClickableText('kids', true)}
                    ${createClickableText('dort', false)}
                    ${createClickableText('hatten', false)}
                    ${createClickableText('kein', false)}
                    ${createClickableText('Internet', false)}.
                </p>
                <button class="btn btn-primary" onclick="checkErrorCorrection(this,'error')">Prüfen</button>
            </div>
        </div>`;
    }
    content.innerHTML=html;
}
function createClickableText(word,isError){ return `<span class="clickable-word" data-error="${isError}">${word}</span>`; }
function createCapitalizeText(word,shouldCap){ return `<span class="capitalize-word" data-capitalize="${shouldCap}">${word}</span>`; }

// Leseverstehen
function loadLeseContent(){
    const content=document.getElementById('leseContent');
    let html='';
    if(currentGrade===6){
        html = `
        <div class="exercise-box">
            <h3>Textinterpretation</h3>
            <div class="sachtext-passage">
                <p><strong>Die Entscheidung</strong></p>
                <p>Als Lukas an jenem regnerischen Novembermorgen erwachte, wusste er bereits, dass dieser Tag anders sein würde. Das Gefühl, das sich in seiner Magengrube zusammenballte, war ihm nicht fremd – es war dieselbe Mischung aus Vorfreude und Unbehagen, die ihn stets begleitete, wenn er vor einer wichtigen Entscheidung stand.</p>
                <p>Seine Eltern hatten ihm am Abend zuvor verkündet, dass sie nach München ziehen würden. Der neue Job seines Vaters sei eine großartige Chance, erklärte seine Mutter mit einem Lächeln, das ihre eigene Unsicherheit nur mühsam verbergen konnte.</p>
            </div>
            <div class="question" id="reading1">
                <p class="question-text">1. Beschreibe Lukas' emotionalen Zustand zu Beginn. Was verrät die Metapher „Magengrube"?</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Die Metapher zeigt seine innere Anspannung und nervöse Vorfreude gemischt mit Sorge.</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Er ist einfach nur müde vom Aufwachen.</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Er freut sich uneingeschränkt auf den Umzug.</div>
            </div>
            <div class="question" id="reading2">
                <p class="question-text">2. Warum lächelt die Mutter, obwohl sie selbst unsicher ist?</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Sie versucht, Lukas zu beruhigen und ihre eigenen Zweifel zu verbergen.</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Sie freut sich aufrichtig über den Umzug.</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Sie versteht Lukas' Gefühle nicht.</div>
            </div>
            <button class="btn btn-primary" onclick="checkReadingAnswers(this,'reading')">Prüfen</button>
        </div>`;
    } else if(currentGrade===7){
        html = `
        <div class="exercise-box">
            <h3>Detailliertes Leseverstehen</h3>
            <div class="sachtext-passage">
                <p>Emma stand am Rand des Schwimmbeckens und starrte auf das Zehn-Meter-Brett. Von hier unten wirkte es noch höher, als sie es in Erinnerung hatte. Ihr Herz klopfte wild, während ihre Klassenkameraden unten warteten und sie anfeuerten. „Du schaffst das!", rief Tom, ihr bester Freund.</p>
                <p>Doch Emma zweifelte. Warum hatte sie überhaupt zugestimmt, von diesem Brett zu springen? Nur weil Lisa behauptet hatte, Emma sei zu ängstlich? Das war doch kindisch. Dennoch wollte sie beweisen, dass Lisa sich irrte.</p>
            </div>
            <div class="question" id="reading3">
                <p class="question-text">1. Was zeigt, dass Emma Angst hat? Nenne zwei Beispiele aus dem Text.</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Ihr wild klopfendes Herz und dass das Brett höher wirkt als erinnert.</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Sie ruft nach Tom und fragt ihn um Hilfe.</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Sie springt sofort vom Brett.</div>
            </div>
            <div class="question" id="reading4">
                <p class="question-text">2. Wie verändert sich Emmas Motivation im Verlauf der Geschichte?</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Anfangs will sie Lisa beweisen, dass diese falsch liegt, später macht sie es für sich selbst.</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Sie bleibt die ganze Zeit über motiviert durch Lisa.</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Sie verliert ihre Motivation vollständig.</div>
            </div>
            <button class="btn btn-primary" onclick="checkReadingAnswers(this,'reading')">Prüfen</button>
        </div>`;
    } else {
        html = `
        <div class="exercise-box">
            <h3>Literarische Analyse</h3>
            <div class="sachtext-passage">
                <p><strong>Die Mutprobe</strong></p>
                <p>Sarah stand vor der verschlossenen Tür. Hinter ihr lag der lange, dunkle Korridor, vor ihr das Unbekannte. Sie hörte ihre Lehrerin noch immer rufen: „Komm zurück! Das ist zu gefährlich!" Aber Sarah wusste, dass sie keine Wahl hatte. Ihre beste Freundin war dort drinnen, und sie würde sie nicht im Stich lassen.</p>
                <p>„Ich mache das nicht für Lisa", flüsterte sie sich selbst zu. „Ich mache das für mich." Mit einem tiefen Atemzug trat sie an den Rand des Bretts, schloss die Augen – und sprang.</p>
            </div>
            <div class="question" id="reading5">
                <p class="question-text">1. Welche sprachlichen Mittel erzeugen Spannung in diesem Text?</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Kurze Sätze, innerer Monolog und die Beschreibung von Gegensätzen (Dunkelheit vs. Unbekanntes).</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Nur lange, beschreibende Sätze.</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Es gibt keine Spannungselemente.</div>
            </div>
            <div class="question" id="reading6">
                <p class="question-text">2. Welche Botschaft könnte diese Geschichte vermitteln?</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Mut bedeutet nicht, keine Angst zu haben, sondern trotz der Angst zu handeln.</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Man sollte immer auf seine Lehrer hören.</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Freundschaft ist unwichtig.</div>
            </div>
            <button class="btn btn-primary" onclick="checkReadingAnswers(this,'reading')">Prüfen</button>
        </div>`;
    }
    content.innerHTML=html;
}

// Sachtexte
function loadSachtexteContent(){
    const content=document.getElementById('sachtexteContent');
    let html='';
    if(currentGrade===6){
        html = `
        <div class="exercise-box">
            <h3>Sachtext: Klimawandel (Grundlagen)</h3>
            <div class="sachtext-passage">
                <p>Der Klimawandel ist eine der größten Herausforderungen unserer Zeit. Die Erderwärmung führt dazu, dass Gletscher schmelzen und der Meeresspiegel steigt. Extreme Wetterereignisse wie Stürme und Dürren werden häufiger. Wissenschaftler sind sich einig: Der Mensch trägt durch den Ausstoß von CO₂ maßgeblich zur Erderwärmung bei.</p>
            </div>
            <div class="question" id="sachtext1">
                <p class="question-text">1. Was ist eine Hauptursache des Klimawandels laut Text?</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Der menschliche Ausstoß von CO₂</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Natürliche Erdzyklen allein</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Die Aktivität der Sonne</div>
            </div>
            <div class="question" id="sachtext2">
                <p class="question-text">2. Welche Folge des Klimawandels wird NICHT erwähnt?</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Zunahme von Erdbeben</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Schmelzende Gletscher</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Extreme Wetterereignisse</div>
            </div>
            <button class="btn btn-primary" onclick="checkReadingAnswers(this,'sachtext')">Prüfen</button>
        </div>`;
    } else if(currentGrade===7){
        html = `
        <div class="exercise-box">
            <h3>Sachtext: Erneuerbare Energien</h3>
            <div class="sachtext-passage">
                <p>Erneuerbare Energien wie Solar- und Windkraft gewinnen zunehmend an Bedeutung. Anders als fossile Brennstoffe sind sie praktisch unerschöpflich und verursachen deutlich weniger CO₂-Emissionen. Allerdings stellt die Energiespeicherung noch eine Herausforderung dar, da Wind und Sonne nicht konstant verfügbar sind. Moderne Batterietechnologien sollen dieses Problem in Zukunft lösen.</p>
            </div>
            <div class="question" id="sachtext3">
                <p class="question-text">1. Welcher Vorteil erneuerbarer Energien wird genannt?</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Sie sind unerschöpflich und verursachen weniger CO₂</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Sie sind immer verfügbar</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Sie brauchen keine Speicherung</div>
            </div>
            <div class="question" id="sachtext4">
                <p class="question-text">2. Was ist laut Text eine aktuelle Herausforderung?</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Die Energiespeicherung bei wechselnder Verfügbarkeit</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Die hohen CO₂-Emissionen</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Die Erschöpfung der Energiequellen</div>
            </div>
            <button class="btn btn-primary" onclick="checkReadingAnswers(this,'sachtext')">Prüfen</button>
        </div>`;
    } else {
        html = `
        <div class="exercise-box">
            <h3>Sachtext: Künstliche Intelligenz</h3>
            <div class="sachtext-passage">
                <p>Künstliche Intelligenz (KI) revolutioniert zahlreiche Bereiche unseres Lebens. Von selbstfahrenden Autos bis zur medizinischen Diagnostik – die Einsatzmöglichkeiten scheinen grenzenlos. Kritiker warnen jedoch vor den Risiken: Arbeitsplätze könnten wegfallen, und die Kontrolle über hochentwickelte KI-Systeme birgt ethische Fragestellungen. Die Gesellschaft steht vor der Aufgabe, einen verantwortungsvollen Umgang mit dieser Technologie zu finden.</p>
            </div>
            <div class="question" id="sachtext5">
                <p class="question-text">1. Der Text präsentiert KI als:</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Technologie mit großem Potenzial, aber auch Risiken</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Ausschließlich positive Entwicklung</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Gefährliche Technologie ohne Nutzen</div>
            </div>
            <div class="question" id="sachtext6">
                <p class="question-text">2. Welche ethische Frage wird impliziert?</p>
                <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Wie kontrollieren und verantworten wir hochentwickelte KI?</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Sollen wir KI komplett verbieten?</div>
                <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Ist KI überhaupt möglich?</div>
            </div>
            <button class="btn btn-primary" onclick="checkReadingAnswers(this,'sachtext')">Prüfen</button>
        </div>`;
    }
    content.innerHTML=html;
}

// Survival
function loadSurvivalContent(){
    const content=document.getElementById('survivalContent');
    const html = `
    <div class="exercise-box">
        <h3>Quiz: „Feuer machen" von Jack London</h3>
        <div class="question" id="survival1">
            <p class="question-text">1. Was ist das zentrale Problem des Protagonisten in der Geschichte?</p>
            <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Er muss bei extremer Kälte ein Feuer machen, um zu überleben.</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Er sucht nach Gold im Yukon.</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Er versucht, einen Fluss zu überqueren.</div>
        </div>
        <div class="question" id="survival2">
            <p class="question-text">2. Welcher fatale Fehler führt zum Tod des Protagonisten?</p>
            <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Er baut das Feuer unter einem schneebeladenen Baum, der das Feuer löscht.</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Er hat keine Streichhölzer dabei.</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Er wird von einem wilden Tier angegriffen.</div>
        </div>
        <div class="question" id="survival3">
            <p class="question-text">3. Welche Rolle spielt der Hund in der Geschichte?</p>
            <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Der Hund folgt seinem Instinkt und überlebt, während der Mensch stirbt.</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Der Hund hilft dem Mann, das Feuer zu machen.</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Der Hund stirbt vor dem Mann.</div>
        </div>
        <div class="question" id="survival4">
            <p class="question-text">4. Was symbolisiert das Feuer in der Geschichte?</p>
            <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Leben, Zivilisation und die Macht des Menschen über die Natur</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Zerstörung und Gefahr</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Nur eine praktische Wärmequelle ohne tiefere Bedeutung</div>
        </div>
        <div class="question" id="survival5">
            <p class="question-text">5. Welche Lektion vermittelt die Geschichte über den Menschen und die Natur?</p>
            <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Die Natur ist übermächtig; Überheblichkeit und Unterschätzung können tödlich sein.</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Der Mensch kann die Natur immer kontrollieren.</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Technologie ist nutzlos in der Wildnis.</div>
        </div>
        <button class="btn btn-primary" onclick="checkReadingAnswers(this,'survival')">Prüfen</button>
    </div>

    <div class="exercise-box">
        <h3>Allgemeines Survival-Wissen</h3>
        <div class="question" id="survival6">
            <p class="question-text">6. Was ist die „Dreierregel" beim Überleben?</p>
            <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">3 Minuten ohne Luft, 3 Stunden ohne Schutz (bei Extremwetter), 3 Tage ohne Wasser, 3 Wochen ohne Nahrung</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">3 Schritte zum Feuermachen</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">3 Arten von essbaren Pflanzen</div>
        </div>
        <div class="question" id="survival7">
            <p class="question-text">7. Welche Priorität hat beim Überleben in der Wildnis die höchste Dringlichkeit?</p>
            <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Schutz vor extremen Witterungsbedingungen (Unterkühlung/Hitzschlag)</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Nahrung finden</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Ein Lager bauen</div>
        </div>
        <div class="question" id="survival8">
            <p class="question-text">8. Wie kann man in der Wildnis trinkbares Wasser gewinnen?</p>
            <div class="mcq-option" data-correct="true" onclick="selectMCQ(this)">Abkochen, Filtern durch Stoff/Sand oder Wasserreinigungstabletten</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Jedes Wasser aus Flüssen ist direkt trinkbar</div>
            <div class="mcq-option" data-correct="false" onclick="selectMCQ(this)">Nur Regenwasser ist sicher</div>
        </div>
        <button class="btn btn-primary" onclick="checkReadingAnswers(this,'survival')">Prüfen</button>
    </div>`;
    content.innerHTML=html;
}

// Ergebnisse
function loadErgebnisseContent(){
    const content=document.getElementById('ergebnisseContent');
    const categories=['grammar','error','reading','sachtext','survival'];
    let html='<div class="stats-grid">';
    categories.forEach(cat=>{
        const d=studentData.exercises[cat];
        const pct=d.attempted>0?Math.round((d.correct/d.attempted)*100):0;
        const names={grammar:'Grammatik',error:'Fehlerkorrektur',reading:'Leseverstehen',sachtext:'Sachtexte',survival:'Survival'};
        html+=`
        <div class="stat-card">
            <h3>${names[cat]}</h3>
            <div class="stat-number">${pct}%</div>
            <div class="stat-label">${d.correct} / ${d.attempted} richtig</div>
            <div class="progress-bar" style="margin-top:10px;"><div class="progress-fill" style="width:${pct}%"></div></div>
        </div>`;
    });
    html+='</div><div class="exercise-box"><h3>Empfehlungen zur Verbesserung</h3>';
    categories.forEach(cat=>{
        const d=studentData.exercises[cat];
        if(d.attempted>0){
            const pct=Math.round((d.correct/d.attempted)*100);
            const names={grammar:'Grammatik',error:'Fehlerkorrektur',reading:'Leseverstehen',sachtext:'Sachtexte',survival:'Survival'};
            if(pct<70){ html+=`<p><strong>${names[cat]}:</strong> Intensiv üben. Gehe die Aufgaben erneut durch und analysiere deine Fehler.</p>`; }
            else if(pct<85){ html+=`<p><strong>${names[cat]}:</strong> Gute Leistung! Mit etwas mehr Übung erreichst du ein sehr hohes Niveau.</p>`; }
            else { html+=`<p><strong>${names[cat]}:</strong> Ausgezeichnet! Halte dieses Niveau mit kurzer Wiederholung.</p>`; }
        }
    });
    html+='</div>';
    content.innerHTML=html;
}

// Download
function downloadResults(){
    const total=Object.values(studentData.exercises).reduce((s,c)=>s+c.attempted,0);
    const correct=Object.values(studentData.exercises).reduce((s,c)=>s+c.correct,0);
    const accuracy=total>0?Math.round((correct/total)*100):0;

    let text=`Deutsch Klassenarbeit Trainer - Ergebnisbericht\n`;
    text+=`Klasse: ${currentGrade}\n`;
    text+=`Datum: ${new Date().toLocaleDateString('de-DE')}\n\n`;
    text+=`Gesamtstatistik:\n- Übungen absolviert: ${total}\n- Richtige Antworten: ${correct}\n- Genauigkeit: ${accuracy}%\n\n`;
    text+=`Detaillierte Ergebnisse:\n\n`;
    const names={grammar:'Grammatik',error:'Fehlerkorrektur',reading:'Leseverstehen',sachtext:'Sachtexte',survival:'Survival'};
    Object.entries(studentData.exercises).forEach(([cat,d])=>{
        const pct=d.attempted>0?Math.round((d.correct/d.attempted)*100):0;
        text+=`${names[cat]}:\n  Versuche: ${d.attempted}\n  Richtig: ${d.correct}\n  Genauigkeit: ${pct}%\n\n`;
    });

    const blob=new Blob([text],{type:'text/plain'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url;
    a.download=`Deutsch_Ergebnisse_Klasse${currentGrade}_${new Date().toISOString().split('T')[0]}.txt`;
    a.click();
    URL.revokeObjectURL(url);
}

// DnD
function initializeDragAndDrop(){
    const draggables=document.querySelectorAll('.draggable-word');
    const dropZones=document.querySelectorAll('.drop-zone');

    draggables.forEach(d=>{
        d.setAttribute('draggable','true');
        d.addEventListener('dragstart',()=>{ d.classList.add('dragging'); });
        d.addEventListener('dragend',()=>{ d.classList.remove('dragging'); });
    });

    dropZones.forEach(zone=>{
        zone.addEventListener('dragover',e=>{
            e.preventDefault();
            const draggable=document.querySelector('.dragging');
            if(draggable && !zone.classList.contains('filled')){ zone.classList.add('drag-over'); }
        });
        zone.addEventListener('dragleave',()=>{ zone.classList.remove('drag-over'); });
        zone.addEventListener('drop',e=>{
            e.preventDefault();
            const draggable=document.querySelector('.dragging');
            if(draggable && !zone.classList.contains('filled')){
                zone.textContent = draggable.textContent;
                zone.classList.add('filled');
            }
            zone.classList.remove('drag-over');
            draggable && draggable.remove();
        });
    });
}

// Checkers
function checkGrammarAnswers(button,category){
    const exercise=button.closest('.exercise-box');
    const zones=exercise.querySelectorAll('.drop-zone');
    let allCorrect=true, correct=0, total=zones.length;
    zones.forEach(z=>{
        const ans=z.getAttribute('data-answer');
        const user=z.textContent.trim();
        if(user===ans){ z.classList.add('correct'); z.classList.remove('incorrect'); correct++; }
        else{ z.classList.add('incorrect'); z.classList.remove('correct'); allCorrect=false; }
    });
    studentData.exercises[category].attempted++;
    if(allCorrect) studentData.exercises[category].correct++;
    saveData(); updateAllStats(); showFeedback(button,correct,total);
}
function checkErrorCorrection(button,category){
    const exercise=button.closest('.exercise-box');
    const words=exercise.querySelectorAll('.clickable-word');
    let correct=0,total=0,allCorrect=true;
    words.forEach(w=>{
        const isError=w.getAttribute('data-error')==='true';
        const selected=w.classList.contains('selected');
        if(isError){ total++; if(selected){ w.classList.add('correct'); w.classList.remove('incorrect','selected'); correct++; } else { w.classList.add('incorrect'); allCorrect=false; } }
        else{ if(selected){ w.classList.add('incorrect'); w.classList.remove('selected'); allCorrect=false; } }
    });
    studentData.exercises[category].attempted++;
    if(allCorrect) studentData.exercises[category].correct++;
    saveData(); updateAllStats(); showFeedback(button,correct,total);
}
function checkCapitalization(button,category){
    const exercise=button.closest('.exercise-box');
    const words=exercise.querySelectorAll('.capitalize-word');
    let correct=0,total=0,allCorrect=true;
    words.forEach(w=>{
        const should=w.getAttribute('data-capitalize')==='true';
        const isCap=w.classList.contains('capitalized');
        if(should){ total++; if(isCap){ correct++; } else { allCorrect=false; w.style.borderColor='#e74c3c'; } }
        else{ if(isCap){ allCorrect=false; w.style.borderColor='#e74c3c'; } }
    });
    studentData.exercises[category].attempted++;
    if(allCorrect) studentData.exercises[category].correct++;
    saveData(); updateAllStats(); showFeedback(button,correct,total);
}
function selectMCQ(opt){
    const q=opt.closest('.question');
    q.querySelectorAll('.mcq-option').forEach(o=>o.classList.remove('selected','correct','incorrect'));
    opt.classList.add('selected');
}
function checkReadingAnswers(button,category){
    const exercise=button.closest('.exercise-box');
    const questions=exercise.querySelectorAll('.question');
    let correct=0,total=questions.length;
    questions.forEach(q=>{
        const sel=q.querySelector('.mcq-option.selected');
        if(sel){
            const ok=sel.getAttribute('data-correct')==='true';
            if(ok){ sel.classList.add('correct'); sel.classList.remove('incorrect'); correct++; }
            else{
                sel.classList.add('incorrect'); sel.classList.remove('correct');
                const corr=q.querySelector('.mcq-option[data-correct="true"]'); corr && corr.classList.add('correct');
            }
        }
    });
    studentData.exercises[category].attempted++;
    if(correct===total) studentData.exercises[category].correct++;
    saveData(); updateAllStats(); showFeedback(button,correct,total);
}
function showFeedback(button,correct,total){
    const old=button.parentElement.querySelector('.feedback'); if(old) old.remove();
    const fb=document.createElement('div'); fb.className='feedback';
    const pct=Math.round((correct/total)*100);
    if(correct===total){ fb.classList.add('correct'); fb.textContent=`Perfekt! Alle ${total} Antworten richtig!`; }
    else if(pct>=70){ fb.classList.add('partial'); fb.textContent=`Gut! ${correct} von ${total} richtig (${pct}%). Weiter so – aber noch verbessern!`; }
    else{ fb.classList.add('incorrect'); fb.textContent=`Nur ${correct} von ${total} richtig (${pct}%). Übe weiter und achte auf die Fehler!`; }
    button.parentElement.appendChild(fb);
}

// Click handlers
document.addEventListener('click',e=>{
    if(e.target.classList.contains('clickable-word')) e.target.classList.toggle('selected');
    if(e.target.classList.contains('capitalize-word')){
        e.target.classList.toggle('capitalized');
        if(e.target.classList.contains('capitalized')){
            e.target.textContent = e.target.textContent.charAt(0).toUpperCase() + e.target.textContent.slice(1);
        } else { e.target.textContent = e.target.textContent.toLowerCase(); }
    }
});

// Init
window.addEventListener('load',()=>{
    loadData();
    // ensure UI reflects saved grade
    selectGrade(null, currentGrade);
    // default active tab (in case saved state landed elsewhere)
    const firstTab=document.querySelector('.tabs .tab');
    firstTab && switchTab(firstTab,'fortschritt');
});
</script>
</body>
</html>
